import { Plugin } from 'obsidian';
import { DEFAULT_SETTINGS } from './types';
import { OllamaServiceImpl } from './services/OllamaService';
import { BlockManager } from './logic/BlockManager';
import { OllamaBlockView } from './ui/OllamaBlockView';
import { OllamaSettingTab } from './settings/SettingsTab';
export default class ObsidianOllamaTestPlugin extends Plugin {
    constructor() {
        super(...arguments);
        this.settings = DEFAULT_SETTINGS;
    }
    async onload() {
        console.log('Obsidian Ollama Test plugin loading (Modular)...');
        await this.loadSettings();
        this.ollamaService = new OllamaServiceImpl(this.settings);
        this.blockManager = new BlockManager(this.app);
        this.addSettingTab(new OllamaSettingTab(this.app, this));
        this.registerMarkdownCodeBlockProcessor('ollama', (source, el, ctx) => {
            const blockSettings = this.blockManager.parseBlock(source);
            const view = new OllamaBlockView(el, this.ollamaService, this.blockManager, ctx, blockSettings);
            view.render();
        });
    }
    async onunload() {
        console.log('Obsidian Ollama Test plugin unloaded');
    }
    async loadSettings() {
        this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
    }
    async saveSettings() {
        await this.saveData(this.settings);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUNsQyxPQUFPLEVBQWtCLGdCQUFnQixFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQzNELE9BQU8sRUFBRSxpQkFBaUIsRUFBaUIsTUFBTSwwQkFBMEIsQ0FBQztBQUM1RSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDcEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRTFELE1BQU0sQ0FBQyxPQUFPLE9BQU8sd0JBQXlCLFNBQVEsTUFBTTtJQUE1RDs7UUFDQyxhQUFRLEdBQW1CLGdCQUFnQixDQUFDO0lBZ0M3QyxDQUFDO0lBNUJBLEtBQUssQ0FBQyxNQUFNO1FBQ1gsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrREFBa0QsQ0FBQyxDQUFDO1FBRWhFLE1BQU0sSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBRTFCLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDMUQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLFlBQVksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFL0MsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLGdCQUFnQixDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUV6RCxJQUFJLENBQUMsa0NBQWtDLENBQUMsUUFBUSxFQUFFLENBQUMsTUFBTSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRTtZQUNyRSxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMzRCxNQUFNLElBQUksR0FBRyxJQUFJLGVBQWUsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRSxhQUFhLENBQUMsQ0FBQztZQUNoRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDZixDQUFDLENBQUMsQ0FBQztJQUNKLENBQUM7SUFFRCxLQUFLLENBQUMsUUFBUTtRQUNiLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0NBQXNDLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBRUQsS0FBSyxDQUFDLFlBQVk7UUFDakIsSUFBSSxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO0lBQzVFLENBQUM7SUFFRCxLQUFLLENBQUMsWUFBWTtRQUNqQixNQUFNLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7Q0FDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBsdWdpbiB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IE9sbGFtYVNldHRpbmdzLCBERUZBVUxUX1NFVFRJTkdTIH0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgeyBPbGxhbWFTZXJ2aWNlSW1wbCwgT2xsYW1hU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvT2xsYW1hU2VydmljZSc7XG5pbXBvcnQgeyBCbG9ja01hbmFnZXIgfSBmcm9tICcuL2xvZ2ljL0Jsb2NrTWFuYWdlcic7XG5pbXBvcnQgeyBPbGxhbWFCbG9ja1ZpZXcgfSBmcm9tICcuL3VpL09sbGFtYUJsb2NrVmlldyc7XG5pbXBvcnQgeyBPbGxhbWFTZXR0aW5nVGFiIH0gZnJvbSAnLi9zZXR0aW5ncy9TZXR0aW5nc1RhYic7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE9ic2lkaWFuT2xsYW1hVGVzdFBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG5cdHNldHRpbmdzOiBPbGxhbWFTZXR0aW5ncyA9IERFRkFVTFRfU0VUVElOR1M7XG5cdG9sbGFtYVNlcnZpY2U6IE9sbGFtYVNlcnZpY2U7XG5cdGJsb2NrTWFuYWdlcjogQmxvY2tNYW5hZ2VyO1xuXG5cdGFzeW5jIG9ubG9hZCgpIHtcblx0XHRjb25zb2xlLmxvZygnT2JzaWRpYW4gT2xsYW1hIFRlc3QgcGx1Z2luIGxvYWRpbmcgKE1vZHVsYXIpLi4uJyk7XG5cblx0XHRhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xuXG5cdFx0dGhpcy5vbGxhbWFTZXJ2aWNlID0gbmV3IE9sbGFtYVNlcnZpY2VJbXBsKHRoaXMuc2V0dGluZ3MpO1xuXHRcdHRoaXMuYmxvY2tNYW5hZ2VyID0gbmV3IEJsb2NrTWFuYWdlcih0aGlzLmFwcCk7XG5cblx0XHR0aGlzLmFkZFNldHRpbmdUYWIobmV3IE9sbGFtYVNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcblxuXHRcdHRoaXMucmVnaXN0ZXJNYXJrZG93bkNvZGVCbG9ja1Byb2Nlc3Nvcignb2xsYW1hJywgKHNvdXJjZSwgZWwsIGN0eCkgPT4ge1xuXHRcdFx0Y29uc3QgYmxvY2tTZXR0aW5ncyA9IHRoaXMuYmxvY2tNYW5hZ2VyLnBhcnNlQmxvY2soc291cmNlKTtcblx0XHRcdGNvbnN0IHZpZXcgPSBuZXcgT2xsYW1hQmxvY2tWaWV3KGVsLCB0aGlzLm9sbGFtYVNlcnZpY2UsIHRoaXMuYmxvY2tNYW5hZ2VyLCBjdHgsIGJsb2NrU2V0dGluZ3MpO1xuXHRcdFx0dmlldy5yZW5kZXIoKTtcblx0XHR9KTtcblx0fVxuXG5cdGFzeW5jIG9udW5sb2FkKCkge1xuXHRcdGNvbnNvbGUubG9nKCdPYnNpZGlhbiBPbGxhbWEgVGVzdCBwbHVnaW4gdW5sb2FkZWQnKTtcblx0fVxuXG5cdGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcblx0XHR0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcblx0fVxuXG5cdGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcblx0XHRhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuXHR9XG59XG4iXX0=