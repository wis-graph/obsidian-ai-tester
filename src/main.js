import { Plugin } from 'obsidian';
import { DEFAULT_SETTINGS } from './types';
import { LLMService } from './services/LLMService';
import { BlockManager } from './logic/BlockManager';
import { OllamaBlockView } from './ui/OllamaBlockView';
import { LLMSettingTab } from './settings/SettingsTab';
export default class AITesterPlugin extends Plugin {
    constructor() {
        super(...arguments);
        this.settings = DEFAULT_SETTINGS;
    }
    async onload() {
        console.log('AI Tester plugin loading...');
        await this.loadSettings();
        this.llmService = new LLMService(this.settings);
        this.blockManager = new BlockManager(this.app);
        this.addSettingTab(new LLMSettingTab(this.app, this));
        this.registerMarkdownCodeBlockProcessor('ollama', (source, el, ctx) => {
            const blockSettings = this.blockManager.parseBlock(source);
            const view = new OllamaBlockView(el, this.llmService, this.blockManager, ctx, blockSettings);
            view.render();
        });
    }
    async onunload() {
        console.log('AI Tester plugin unloaded');
    }
    async loadSettings() {
        this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
    }
    async saveSettings() {
        await this.saveData(this.settings);
        this.llmService.updateSettings(this.settings);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUNsQyxPQUFPLEVBQWUsZ0JBQWdCLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDeEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ25ELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDdkQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRXZELE1BQU0sQ0FBQyxPQUFPLE9BQU8sY0FBZSxTQUFRLE1BQU07SUFBbEQ7O1FBQ0MsYUFBUSxHQUFnQixnQkFBZ0IsQ0FBQztJQWlDMUMsQ0FBQztJQTdCQSxLQUFLLENBQUMsTUFBTTtRQUNYLE9BQU8sQ0FBQyxHQUFHLENBQUMsNkJBQTZCLENBQUMsQ0FBQztRQUUzQyxNQUFNLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUUxQixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksVUFBVSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNoRCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksWUFBWSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUUvQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksYUFBYSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUV0RCxJQUFJLENBQUMsa0NBQWtDLENBQUMsUUFBUSxFQUFFLENBQUMsTUFBTSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRTtZQUNyRSxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMzRCxNQUFNLElBQUksR0FBRyxJQUFJLGVBQWUsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRSxhQUFhLENBQUMsQ0FBQztZQUM3RixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDZixDQUFDLENBQUMsQ0FBQztJQUNKLENBQUM7SUFFRCxLQUFLLENBQUMsUUFBUTtRQUNiLE9BQU8sQ0FBQyxHQUFHLENBQUMsMkJBQTJCLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRUQsS0FBSyxDQUFDLFlBQVk7UUFDakIsSUFBSSxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO0lBQzVFLENBQUM7SUFFRCxLQUFLLENBQUMsWUFBWTtRQUNqQixNQUFNLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ25DLElBQUksQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUMvQyxDQUFDO0NBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQbHVnaW4gfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBMTE1TZXR0aW5ncywgREVGQVVMVF9TRVRUSU5HUyB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHsgTExNU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvTExNU2VydmljZSc7XG5pbXBvcnQgeyBCbG9ja01hbmFnZXIgfSBmcm9tICcuL2xvZ2ljL0Jsb2NrTWFuYWdlcic7XG5pbXBvcnQgeyBPbGxhbWFCbG9ja1ZpZXcgfSBmcm9tICcuL3VpL09sbGFtYUJsb2NrVmlldyc7XG5pbXBvcnQgeyBMTE1TZXR0aW5nVGFiIH0gZnJvbSAnLi9zZXR0aW5ncy9TZXR0aW5nc1RhYic7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFJVGVzdGVyUGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcblx0c2V0dGluZ3M6IExMTVNldHRpbmdzID0gREVGQVVMVF9TRVRUSU5HUztcblx0bGxtU2VydmljZTogTExNU2VydmljZTtcblx0YmxvY2tNYW5hZ2VyOiBCbG9ja01hbmFnZXI7XG5cblx0YXN5bmMgb25sb2FkKCkge1xuXHRcdGNvbnNvbGUubG9nKCdBSSBUZXN0ZXIgcGx1Z2luIGxvYWRpbmcuLi4nKTtcblxuXHRcdGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG5cblx0XHR0aGlzLmxsbVNlcnZpY2UgPSBuZXcgTExNU2VydmljZSh0aGlzLnNldHRpbmdzKTtcblx0XHR0aGlzLmJsb2NrTWFuYWdlciA9IG5ldyBCbG9ja01hbmFnZXIodGhpcy5hcHApO1xuXG5cdFx0dGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBMTE1TZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG5cblx0XHR0aGlzLnJlZ2lzdGVyTWFya2Rvd25Db2RlQmxvY2tQcm9jZXNzb3IoJ29sbGFtYScsIChzb3VyY2UsIGVsLCBjdHgpID0+IHtcblx0XHRcdGNvbnN0IGJsb2NrU2V0dGluZ3MgPSB0aGlzLmJsb2NrTWFuYWdlci5wYXJzZUJsb2NrKHNvdXJjZSk7XG5cdFx0XHRjb25zdCB2aWV3ID0gbmV3IE9sbGFtYUJsb2NrVmlldyhlbCwgdGhpcy5sbG1TZXJ2aWNlLCB0aGlzLmJsb2NrTWFuYWdlciwgY3R4LCBibG9ja1NldHRpbmdzKTtcblx0XHRcdHZpZXcucmVuZGVyKCk7XG5cdFx0fSk7XG5cdH1cblxuXHRhc3luYyBvbnVubG9hZCgpIHtcblx0XHRjb25zb2xlLmxvZygnQUkgVGVzdGVyIHBsdWdpbiB1bmxvYWRlZCcpO1xuXHR9XG5cblx0YXN5bmMgbG9hZFNldHRpbmdzKCkge1xuXHRcdHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xuXHR9XG5cblx0YXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuXHRcdGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XG5cdFx0dGhpcy5sbG1TZXJ2aWNlLnVwZGF0ZVNldHRpbmdzKHRoaXMuc2V0dGluZ3MpO1xuXHR9XG59XG5cbiJdfQ==