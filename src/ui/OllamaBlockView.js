import { Notice, setIcon } from 'obsidian';
export class OllamaBlockView {
    constructor(el, service, manager, ctx, blockSettings) {
        this.components = {};
        this.el = el;
        this.service = service;
        this.manager = manager;
        this.ctx = ctx;
        this.blockSettings = blockSettings;
    }
    render() {
        this.el.empty();
        this.createLayout();
        this.initializeController();
        this.restoreFocus();
    }
    createLayout() {
        const container = this.el.createDiv({ cls: 'ollama-container' });
        container.style.cssText = 'padding: 12px; background: var(--background-secondary); border-radius: 8px; margin: 10px 0;';
        const headerRow = container.createDiv({ cls: 'ollama-header' });
        headerRow.style.cssText = 'display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;';
        headerRow.createEl('label', { text: 'Prompt:', cls: 'setting-item-name' }).style.cssText = 'font-weight: 600; margin-right: 16px;';
        const controlsRow = headerRow.createDiv({ cls: 'ollama-controls' });
        controlsRow.style.cssText = 'display: flex; align-items: center; gap: 8px;';
        // Provider Selection
        const providerDropdown = controlsRow.createEl('select', { cls: 'ollama-provider-dropdown dropdown' });
        providerDropdown.style.cssText = 'padding: 4px 12px; border: 1px solid var(--background-modifier-border); border-radius: 4px; background: var(--background-primary); color: var(--text-normal); font-size: var(--font-smaller); cursor: pointer;';
        const providers = this.service.getEnabledProviders();
        providers.forEach(p => {
            providerDropdown.createEl('option', { value: p.id, text: p.name });
        });
        providerDropdown.value = this.blockSettings.yamlConfig.provider || this.service.getSettings().activeProvider;
        // Model Selection
        const modelLabel = controlsRow.createEl('label', { text: 'Model:', cls: 'setting-item-name' });
        modelLabel.style.cssText = 'font-size: var(--font-smaller); font-weight: 500; font-family: var(--font-interface); margin-left: 8px;';
        const modelDropdown = controlsRow.createEl('select', { cls: 'ollama-model-dropdown dropdown' });
        modelDropdown.style.cssText = 'padding: 4px 32px 4px 12px; border: 1px solid var(--background-modifier-border); border-radius: 4px; background: var(--background-primary); color: var(--text-normal); font-size: var(--font-smaller); line-height: 1.5; cursor: pointer; min-width: 140px; width: fit-content; max-width: 300px; height: auto;';
        let advancedButton = null;
        let configTextarea = null;
        let configDisplay = null;
        if (this.blockSettings.hasYaml) {
            advancedButton = controlsRow.createEl('button', { cls: 'ollama-advanced-button' });
            setIcon(advancedButton, 'settings');
            advancedButton.style.cssText = 'padding: 4px; border: none; border-radius: 4px; cursor: pointer; background: transparent; display: flex; align-items: center; justify-content: center; margin-left: 4px;';
            advancedButton.title = 'Advanced Settings';
            configDisplay = container.createDiv({ cls: 'ollama-config-display' });
            configDisplay.style.cssText = 'display: none; background: var(--background-primary); border: 1px solid var(--background-modifier-border); border-radius: 4px; padding: 12px; margin-bottom: 12px; font-size: var(--font-smaller);';
            configTextarea = configDisplay.createEl('textarea', { attr: { rows: 8, placeholder: 'YAML configuration...' } });
            configTextarea.style.cssText = 'width: 100%; padding: 8px; border: 1px solid var(--background-modifier-border); border-radius: 4px; background: var(--background-primary); color: var(--text-normal); resize: vertical; font-family: var(--font-monospace); font-size: var(--font-smaller);';
            configTextarea.value = this.manager.generateYamlFromConfig(this.blockSettings.yamlConfig);
        }
        const promptContainer = container.createDiv({ cls: 'ollama-prompt-container' });
        promptContainer.style.cssText = 'position: relative; width: 100%; margin-bottom: 12px;';
        const promptInput = promptContainer.createEl('div', { cls: 'ollama-prompt-input', attr: { contenteditable: 'true', 'data-placeholder': 'Enter prompt...' } });
        promptInput.innerHTML = this.blockSettings.prompt;
        promptInput.style.cssText = 'width: 100%; padding: 12px; padding-bottom: 45px; border: 1px solid var(--background-modifier-border); border-radius: 8px; background: var(--background-primary); color: var(--text-normal); overflow: auto; min-height: 100px; white-space: pre-wrap; word-wrap: break-word; outline: none; transition: border-color 0.2s;';
        promptInput.addEventListener('focus', () => promptInput.style.borderColor = 'var(--interactive-accent)');
        promptInput.addEventListener('blur', () => promptInput.style.borderColor = 'var(--background-modifier-border)');
        const actionButtons = promptContainer.createDiv({ cls: 'ollama-action-buttons' });
        actionButtons.style.cssText = 'position: absolute; bottom: 10px; right: 10px; display: flex; gap: 8px; align-items: center;';
        const copyButton = actionButtons.createEl('button', { cls: 'ollama-copy-button' });
        setIcon(copyButton, 'copy');
        copyButton.style.cssText = 'width: 42px; height: 42px; border: none; border-radius: 50%; cursor: pointer; background: var(--background-modifier-border); opacity: 0.9; transition: all 0.2s; display: flex; align-items: center; justify-content: center; color: var(--text-normal);';
        copyButton.title = 'Copy prompt';
        const copyIcon = copyButton.querySelector('svg');
        if (copyIcon) {
            copyIcon.style.width = '28px';
            copyIcon.style.height = '28px';
        }
        copyButton.addEventListener('mouseenter', () => {
            copyButton.style.opacity = '1';
            copyButton.style.background = 'var(--background-modifier-border-hover)';
            copyButton.style.transform = 'scale(1.05)';
        });
        copyButton.addEventListener('mouseleave', () => {
            copyButton.style.opacity = '0.9';
            copyButton.style.background = 'var(--background-modifier-border)';
            copyButton.style.transform = 'scale(1)';
        });
        const saveButton = actionButtons.createEl('button', { cls: 'ollama-save-button' });
        setIcon(saveButton, 'save');
        saveButton.style.cssText = 'width: 42px; height: 42px; border: none; border-radius: 50%; cursor: pointer; background: var(--background-modifier-border); opacity: 0.9; transition: all 0.2s; display: flex; align-items: center; justify-content: center; color: var(--text-normal);';
        saveButton.title = 'Save prompt (Ctrl+S)';
        const saveIcon = saveButton.querySelector('svg');
        if (saveIcon) {
            saveIcon.style.width = '24px';
            saveIcon.style.height = '24px';
        }
        saveButton.addEventListener('mouseenter', () => {
            saveButton.style.opacity = '1';
            saveButton.style.background = 'var(--interactive-accent)';
            saveButton.style.color = 'var(--text-on-accent)';
            saveButton.style.transform = 'scale(1.05)';
        });
        saveButton.addEventListener('mouseleave', () => {
            saveButton.style.opacity = '0.9';
            saveButton.style.background = 'var(--background-modifier-border)';
            saveButton.style.color = 'var(--text-normal)';
            saveButton.style.transform = 'scale(1)';
        });
        const clearButton = actionButtons.createEl('button', { cls: 'ollama-clear-button' });
        setIcon(clearButton, 'trash');
        clearButton.style.cssText = 'width: 42px; height: 42px; border: none; border-radius: 50%; cursor: pointer; background: var(--background-modifier-border); opacity: 0.9; transition: all 0.2s; display: flex; align-items: center; justify-content: center; color: var(--text-normal);';
        clearButton.title = 'Clear prompt';
        const clearIcon = clearButton.querySelector('svg');
        if (clearIcon) {
            clearIcon.style.width = '28px';
            clearIcon.style.height = '28px';
        }
        clearButton.addEventListener('mouseenter', () => {
            clearButton.style.opacity = '1';
            clearButton.style.background = 'var(--text-error)';
            clearButton.style.color = 'white';
            clearButton.style.transform = 'scale(1.05)';
        });
        clearButton.addEventListener('mouseleave', () => {
            clearButton.style.opacity = '0.9';
            clearButton.style.background = 'var(--background-modifier-border)';
            clearButton.style.color = 'var(--text-normal)';
            clearButton.style.transform = 'scale(1)';
        });
        const submitButton = actionButtons.createEl('button', { cls: 'ollama-submit-button mod-cta' });
        setIcon(submitButton, 'send');
        submitButton.style.cssText = 'width: 42px; height: 42px; border: none; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; padding: 0;';
        submitButton.title = 'Generate (Enter)';
        const submitIcon = submitButton.querySelector('svg');
        if (submitIcon) {
            submitIcon.style.width = '20px';
            submitIcon.style.height = '20px';
        }
        const buttonContainer = container.createDiv({ cls: 'ollama-button-container' });
        buttonContainer.style.cssText = 'display: flex; gap: 10px; align-items: center; justify-content: flex-start;';
        const responsesContainer = buttonContainer.createDiv({ cls: 'ollama-responses-control' });
        responsesContainer.style.cssText = 'display: flex; align-items: center; gap: 8px; margin-left: auto;';
        responsesContainer.createEl('label', { text: 'Responses:', cls: 'setting-item-name' }).style.cssText = 'font-size: var(--font-smaller);';
        const initialResponses = this.blockSettings.yamlConfig.num_responses || 1;
        const responsesSlider = responsesContainer.createEl('input', { cls: 'ollama-responses-slider', attr: { type: 'range', min: '1', max: '20', value: initialResponses.toString(), step: '1' } });
        responsesSlider.style.cssText = 'width: 100px; cursor: pointer;';
        const responsesInput = responsesContainer.createEl('input', { cls: 'ollama-responses-input', attr: { type: 'number', min: '1', max: '20', value: initialResponses.toString() } });
        responsesInput.style.cssText = 'width: 50px; padding: 4px 8px; border: 1px solid var(--background-modifier-border); border-radius: 4px; background: var(--background-primary); color: var(--text-normal); font-size: var(--font-smaller);';
        const responsesWrapper = container.createDiv({ cls: 'ollama-responses-wrapper' });
        responsesWrapper.style.cssText = 'margin-top: 12px; display: none; flex-direction: column; gap: 8px;';
        this.components = { providerDropdown, modelDropdown, advancedButton, configDisplay, configTextarea, responsesSlider, responsesInput, promptInput, copyButton, clearButton, submitButton, saveButton, responsesWrapper };
    }
    initializeController() {
        const { providerDropdown, modelDropdown, advancedButton, configDisplay, configTextarea, responsesSlider, responsesInput, promptInput, copyButton, clearButton, submitButton, saveButton, responsesWrapper } = this.components;
        let abortController = null;
        let isGenerating = false;
        const updateSubmitButtonState = () => {
            const hasContent = promptInput.innerText.trim().length > 0;
            if (isGenerating) {
                submitButton.disabled = false;
                submitButton.style.opacity = '1';
                submitButton.style.backgroundColor = 'var(--text-error)';
                submitButton.style.color = 'white';
                setIcon(submitButton, 'square');
                const icon = submitButton.querySelector('svg');
                if (icon) {
                    icon.style.width = '14px';
                    icon.style.height = '14px';
                }
                submitButton.title = 'Stop generating';
            }
            else {
                submitButton.disabled = !hasContent;
                submitButton.style.opacity = hasContent ? '1' : '0.4';
                submitButton.style.backgroundColor = hasContent ? 'var(--interactive-accent)' : 'var(--background-modifier-border)';
                submitButton.style.color = hasContent ? 'var(--text-on-accent)' : 'var(--text-muted)';
                setIcon(submitButton, 'send');
                const icon = submitButton.querySelector('svg');
                if (icon) {
                    icon.style.width = '20px';
                    icon.style.height = '20px';
                }
                submitButton.title = hasContent ? 'Generate (Enter)' : 'Enter prompt to generate';
            }
        };
        updateSubmitButtonState();
        const populateModels = async () => {
            try {
                const providerId = providerDropdown.value;
                const provider = this.service.getProvider(providerId);
                const res = await provider.fetchModels();
                modelDropdown.innerHTML = '';
                res.models.forEach((m) => {
                    modelDropdown.createEl('option', { value: m.id, text: m.name });
                });
                const savedModel = this.blockSettings.yamlConfig.model;
                const defaultModel = providerId === 'ollama' ? this.service.getSettings().ollama.model : this.service.getSettings().openai.model;
                modelDropdown.value = savedModel || defaultModel;
            }
            catch (e) {
                new Notice('Failed to load models for selected provider');
            }
        };
        populateModels();
        providerDropdown.addEventListener('change', async () => {
            const providerId = providerDropdown.value;
            this.blockSettings.yamlConfig.provider = providerId;
            this.blockSettings.yamlConfig.model = ''; // Reset model on provider change
            const newYaml = this.manager.generateYamlFromConfig(this.blockSettings.yamlConfig);
            this.manager.updateFileBlock(this.el, this.ctx, promptInput.innerText.trim(), newYaml);
            if (configTextarea)
                configTextarea.value = newYaml;
            await populateModels();
        });
        modelDropdown.addEventListener('change', () => {
            this.blockSettings.yamlConfig.model = modelDropdown.value;
            const newYaml = this.manager.generateYamlFromConfig(this.blockSettings.yamlConfig);
            this.manager.updateFileBlock(this.el, this.ctx, promptInput.innerText.trim(), newYaml);
            if (configTextarea)
                configTextarea.value = newYaml;
        });
        if (copyButton) {
            copyButton.addEventListener('click', async () => {
                const text = promptInput.innerText.trim();
                if (text) {
                    await navigator.clipboard.writeText(text);
                    new Notice('Prompt copied to clipboard');
                }
            });
        }
        if (clearButton) {
            clearButton.addEventListener('click', () => {
                promptInput.innerText = '';
                updateSubmitButtonState();
                const yaml = this.blockSettings.hasYaml ? configTextarea.value : '';
                this.manager.updateFileBlock(this.el, this.ctx, '', yaml);
                new Notice('Prompt cleared');
            });
        }
        if (advancedButton) {
            advancedButton.addEventListener('click', () => {
                const isHidden = configDisplay.style.display === 'none';
                configDisplay.style.display = isHidden ? 'block' : 'none';
                advancedButton.style.background = isHidden ? 'var(--background-modifier-active-hover)' : 'transparent';
            });
            configTextarea.addEventListener('blur', () => {
                this.manager.updateFileBlock(this.el, this.ctx, promptInput.innerText.trim(), configTextarea.value.trim());
            });
        }
        const updateResponseCount = this.debounce((val) => {
            this.blockSettings.yamlConfig.num_responses = val;
            const newYaml = this.manager.generateYamlFromConfig(this.blockSettings.yamlConfig);
            this.manager.updateFileBlock(this.el, this.ctx, promptInput.innerText.trim(), newYaml);
            if (configTextarea)
                configTextarea.value = newYaml;
        }, 1000);
        responsesSlider.addEventListener('input', () => {
            responsesInput.value = responsesSlider.value;
            updateResponseCount(parseInt(responsesSlider.value));
        });
        responsesInput.addEventListener('input', () => {
            responsesSlider.value = responsesInput.value;
            updateResponseCount(parseInt(responsesInput.value));
        });
        const startGeneration = async () => {
            if (isGenerating) {
                abortController === null || abortController === void 0 ? void 0 : abortController.abort();
                return;
            }
            const prompt = promptInput.innerText.trim();
            if (!prompt)
                return;
            isGenerating = true;
            updateSubmitButtonState();
            const count = parseInt(responsesInput.value) || 1;
            responsesWrapper.style.display = 'flex';
            responsesWrapper.innerHTML = '';
            abortController = new AbortController();
            const providerId = providerDropdown.value;
            const provider = this.service.getProvider(providerId);
            try {
                for (let i = 0; i < count; i++) {
                    const item = responsesWrapper.createDiv({ cls: 'ollama-response-item' });
                    item.style.cssText = 'background: var(--background-primary); border: 1px solid var(--background-modifier-border); border-radius: 8px; padding: 12px; margin-bottom: 8px;';
                    const content = item.createDiv();
                    const outputPre = content.createEl('pre', { cls: 'ollama-output' });
                    outputPre.style.cssText = 'white-space: pre-wrap; font-size: var(--font-smaller); font-family: var(--font-monospace);';
                    try {
                        let statsShown = false;
                        const footerContainer = item.createDiv({ cls: 'ollama-response-footer' });
                        footerContainer.style.cssText = 'display: flex; justify-content: space-between; align-items: flex-end; margin-top: 8px; border-top: 1px solid var(--background-modifier-border); padding-top: 4px; position: relative;';
                        const copyRespButton = footerContainer.createEl('button', { cls: 'ollama-response-copy-button' });
                        setIcon(copyRespButton, 'copy');
                        copyRespButton.style.cssText = 'padding: 4px; border: none; border-radius: 4px; cursor: pointer; background: transparent; opacity: 0.3; transition: opacity 0.2s; display: flex; align-items: center; justify-content: center;';
                        copyRespButton.title = 'Copy response';
                        copyRespButton.addEventListener('mouseenter', () => copyRespButton.style.opacity = '1');
                        copyRespButton.addEventListener('mouseleave', () => copyRespButton.style.opacity = '0.3');
                        copyRespButton.addEventListener('click', async () => {
                            await navigator.clipboard.writeText(outputPre.textContent || '');
                            new Notice('Response copied');
                        });
                        const statsDiv = footerContainer.createDiv({ cls: 'ollama-stats' });
                        statsDiv.style.cssText = 'font-size: 10px; color: var(--text-muted);';
                        await provider.streamResponse(prompt, modelDropdown.value, this.blockSettings.yamlConfig, abortController, (chunk) => {
                            outputPre.textContent += chunk;
                        }, (final) => {
                            if (final.total_duration && !statsShown) {
                                statsShown = true;
                                const durationSec = (final.total_duration / 1e9).toFixed(2);
                                const totalTokens = (final.prompt_eval_count || 0) + (final.eval_count || 0);
                                statsDiv.textContent = `Tokens: ${totalTokens} | Time: ${durationSec}s`;
                            }
                        });
                    }
                    catch (e) {
                        if (e.name === 'AbortError')
                            break;
                        content.createDiv({ text: `Error: ${e.message}` }).style.color = 'var(--text-error)';
                        break;
                    }
                }
            }
            finally {
                isGenerating = false;
                updateSubmitButtonState();
            }
        };
        submitButton.addEventListener('click', startGeneration);
        const manualSave = async () => {
            const yaml = this.blockSettings.hasYaml ? configTextarea.value : '';
            await this.manager.updateFileBlock(this.el, this.ctx, promptInput.innerText.trim(), yaml);
            new Notice('Saved');
        };
        saveButton.addEventListener('click', manualSave);
        promptInput.addEventListener('input', () => {
            updateSubmitButtonState();
        });
        promptInput.addEventListener('blur', () => {
            const yaml = this.blockSettings.hasYaml ? configTextarea.value : '';
            this.manager.updateFileBlock(this.el, this.ctx, promptInput.innerText.trim(), yaml);
        });
        promptInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                startGeneration();
            }
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                manualSave();
            }
        });
        // Track focus/cursor position
        const trackFocus = () => {
            const section = this.ctx.getSectionInfo(this.el);
            if (!section)
                return;
            const selection = window.getSelection();
            if (!selection || selection.rangeCount === 0)
                return;
            const range = selection.getRangeAt(0);
            const preRange = range.cloneRange();
            preRange.selectNodeContents(promptInput);
            preRange.setEnd(range.startContainer, range.startOffset);
            const offset = preRange.toString().length;
            this.manager.sessionFocus = {
                lineStart: section.lineStart,
                ch: offset,
                file: this.ctx.sourcePath
            };
        };
        promptInput.addEventListener('keyup', trackFocus);
        promptInput.addEventListener('mouseup', trackFocus);
        promptInput.addEventListener('focus', trackFocus);
    }
    restoreFocus() {
        const { promptInput } = this.components;
        const section = this.ctx.getSectionInfo(this.el);
        const focus = this.manager.sessionFocus;
        if (section && focus.lineStart === section.lineStart && focus.file === this.ctx.sourcePath) {
            promptInput.focus();
            if (focus.ch !== null) {
                const selection = window.getSelection();
                const range = document.createRange();
                let currentOffset = 0;
                let targetNode = null;
                let targetOffset = 0;
                const findNode = (node) => {
                    if (node.nodeType === Node.TEXT_NODE) {
                        const len = node.length;
                        if (currentOffset + len >= focus.ch) {
                            targetNode = node;
                            targetOffset = focus.ch - currentOffset;
                            return true;
                        }
                        currentOffset += len;
                    }
                    else {
                        for (let i = 0; i < node.childNodes.length; i++) {
                            if (findNode(node.childNodes[i]))
                                return true;
                        }
                    }
                    return false;
                };
                findNode(promptInput);
                if (targetNode) {
                    range.setStart(targetNode, targetOffset);
                    range.collapse(true);
                    selection === null || selection === void 0 ? void 0 : selection.removeAllRanges();
                    selection === null || selection === void 0 ? void 0 : selection.addRange(range);
                }
                else {
                    // Fallback to end
                    range.selectNodeContents(promptInput);
                    range.collapse(false);
                    selection === null || selection === void 0 ? void 0 : selection.removeAllRanges();
                    selection === null || selection === void 0 ? void 0 : selection.addRange(range);
                }
            }
        }
    }
    debounce(fn, wait) {
        let t;
        return (...args) => {
            clearTimeout(t);
            t = setTimeout(() => fn.apply(this, args), wait);
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT2xsYW1hQmxvY2tWaWV3LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiT2xsYW1hQmxvY2tWaWV3LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQWdDLE9BQU8sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUt6RSxNQUFNLE9BQU8sZUFBZTtJQVN4QixZQUFZLEVBQWUsRUFBRSxPQUFtQixFQUFFLE9BQXFCLEVBQUUsR0FBaUMsRUFBRSxhQUErQjtRQUZuSSxlQUFVLEdBQVEsRUFBRSxDQUFDO1FBR3pCLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDO1FBQ2IsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7UUFDZixJQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztJQUN2QyxDQUFDO0lBRUQsTUFBTTtRQUNGLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDaEIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1FBQzVCLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN4QixDQUFDO0lBRU8sWUFBWTtRQUNoQixNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxrQkFBa0IsRUFBRSxDQUFDLENBQUM7UUFDakUsU0FBUyxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsNkZBQTZGLENBQUM7UUFFeEgsTUFBTSxTQUFTLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxlQUFlLEVBQUUsQ0FBQyxDQUFDO1FBQ2hFLFNBQVMsQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLDBGQUEwRixDQUFDO1FBQ3JILFNBQVMsQ0FB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Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5vdGljZSwgTWFya2Rvd25Qb3N0UHJvY2Vzc29yQ29udGV4dCwgc2V0SWNvbiB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IExMTUJsb2NrU2V0dGluZ3MsIFByb3ZpZGVyVHlwZSwgTExNTW9kZWwgfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgeyBMTE1TZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvTExNU2VydmljZSc7XG5pbXBvcnQgeyBCbG9ja01hbmFnZXIgfSBmcm9tICcuLi9sb2dpYy9CbG9ja01hbmFnZXInO1xuXG5leHBvcnQgY2xhc3MgT2xsYW1hQmxvY2tWaWV3IHtcbiAgICBwcml2YXRlIGVsOiBIVE1MRWxlbWVudDtcbiAgICBwcml2YXRlIHNlcnZpY2U6IExMTVNlcnZpY2U7XG4gICAgcHJpdmF0ZSBtYW5hZ2VyOiBCbG9ja01hbmFnZXI7XG4gICAgcHJpdmF0ZSBjdHg6IE1hcmtkb3duUG9zdFByb2Nlc3NvckNvbnRleHQ7XG4gICAgcHJpdmF0ZSBibG9ja1NldHRpbmdzOiBMTE1CbG9ja1NldHRpbmdzO1xuXG4gICAgcHJpdmF0ZSBjb21wb25lbnRzOiBhbnkgPSB7fTtcblxuICAgIGNvbnN0cnVjdG9yKGVsOiBIVE1MRWxlbWVudCwgc2VydmljZTogTExNU2VydmljZSwgbWFuYWdlcjogQmxvY2tNYW5hZ2VyLCBjdHg6IE1hcmtkb3duUG9zdFByb2Nlc3NvckNvbnRleHQsIGJsb2NrU2V0dGluZ3M6IExMTUJsb2NrU2V0dGluZ3MpIHtcbiAgICAgICAgdGhpcy5lbCA9IGVsO1xuICAgICAgICB0aGlzLnNlcnZpY2UgPSBzZXJ2aWNlO1xuICAgICAgICB0aGlzLm1hbmFnZXIgPSBtYW5hZ2VyO1xuICAgICAgICB0aGlzLmN0eCA9IGN0eDtcbiAgICAgICAgdGhpcy5ibG9ja1NldHRpbmdzID0gYmxvY2tTZXR0aW5ncztcbiAgICB9XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHRoaXMuZWwuZW1wdHkoKTtcbiAgICAgICAgdGhpcy5jcmVhdGVMYXlvdXQoKTtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplQ29udHJvbGxlcigpO1xuICAgICAgICB0aGlzLnJlc3RvcmVGb2N1cygpO1xuICAgIH1cblxuICAgIHByaXZhdGUgY3JlYXRlTGF5b3V0KCkge1xuICAgICAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmVsLmNyZWF0ZURpdih7IGNsczogJ29sbGFtYS1jb250YWluZXInIH0pO1xuICAgICAgICBjb250YWluZXIuc3R5bGUuY3NzVGV4dCA9ICdwYWRkaW5nOiAxMnB4OyBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLXNlY29uZGFyeSk7IGJvcmRlci1yYWRpdXM6IDhweDsgbWFyZ2luOiAxMHB4IDA7JztcblxuICAgICAgICBjb25zdCBoZWFkZXJSb3cgPSBjb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiAnb2xsYW1hLWhlYWRlcicgfSk7XG4gICAgICAgIGhlYWRlclJvdy5zdHlsZS5jc3NUZXh0ID0gJ2Rpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsgbWFyZ2luLWJvdHRvbTogMTJweDsnO1xuICAgICAgICBoZWFkZXJSb3cuY3JlYXRlRWwoJ2xhYmVsJywgeyB0ZXh0OiAnUHJvbXB0OicsIGNsczogJ3NldHRpbmctaXRlbS1uYW1lJyB9KS5zdHlsZS5jc3NUZXh0ID0gJ2ZvbnQtd2VpZ2h0OiA2MDA7IG1hcmdpbi1yaWdodDogMTZweDsnO1xuXG4gICAgICAgIGNvbnN0IGNvbnRyb2xzUm93ID0gaGVhZGVyUm93LmNyZWF0ZURpdih7IGNsczogJ29sbGFtYS1jb250cm9scycgfSk7XG4gICAgICAgIGNvbnRyb2xzUm93LnN0eWxlLmNzc1RleHQgPSAnZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiA4cHg7JztcblxuICAgICAgICAvLyBQcm92aWRlciBTZWxlY3Rpb25cbiAgICAgICAgY29uc3QgcHJvdmlkZXJEcm9wZG93biA9IGNvbnRyb2xzUm93LmNyZWF0ZUVsKCdzZWxlY3QnLCB7IGNsczogJ29sbGFtYS1wcm92aWRlci1kcm9wZG93biBkcm9wZG93bicgfSk7XG4gICAgICAgIHByb3ZpZGVyRHJvcGRvd24uc3R5bGUuY3NzVGV4dCA9ICdwYWRkaW5nOiA0cHggMTJweDsgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpOyBib3JkZXItcmFkaXVzOiA0cHg7IGJhY2tncm91bmQ6IHZhcigtLWJhY2tncm91bmQtcHJpbWFyeSk7IGNvbG9yOiB2YXIoLS10ZXh0LW5vcm1hbCk7IGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zbWFsbGVyKTsgY3Vyc29yOiBwb2ludGVyOyc7XG5cbiAgICAgICAgY29uc3QgcHJvdmlkZXJzID0gdGhpcy5zZXJ2aWNlLmdldEVuYWJsZWRQcm92aWRlcnMoKTtcbiAgICAgICAgcHJvdmlkZXJzLmZvckVhY2gocCA9PiB7XG4gICAgICAgICAgICBwcm92aWRlckRyb3Bkb3duLmNyZWF0ZUVsKCdvcHRpb24nLCB7IHZhbHVlOiBwLmlkLCB0ZXh0OiBwLm5hbWUgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBwcm92aWRlckRyb3Bkb3duLnZhbHVlID0gdGhpcy5ibG9ja1NldHRpbmdzLnlhbWxDb25maWcucHJvdmlkZXIgfHwgdGhpcy5zZXJ2aWNlLmdldFNldHRpbmdzKCkuYWN0aXZlUHJvdmlkZXI7XG5cbiAgICAgICAgLy8gTW9kZWwgU2VsZWN0aW9uXG4gICAgICAgIGNvbnN0IG1vZGVsTGFiZWwgPSBjb250cm9sc1Jvdy5jcmVhdGVFbCgnbGFiZWwnLCB7IHRleHQ6ICdNb2RlbDonLCBjbHM6ICdzZXR0aW5nLWl0ZW0tbmFtZScgfSk7XG4gICAgICAgIG1vZGVsTGFiZWwuc3R5bGUuY3NzVGV4dCA9ICdmb250LXNpemU6IHZhcigtLWZvbnQtc21hbGxlcik7IGZvbnQtd2VpZ2h0OiA1MDA7IGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LWludGVyZmFjZSk7IG1hcmdpbi1sZWZ0OiA4cHg7JztcblxuICAgICAgICBjb25zdCBtb2RlbERyb3Bkb3duID0gY29udHJvbHNSb3cuY3JlYXRlRWwoJ3NlbGVjdCcsIHsgY2xzOiAnb2xsYW1hLW1vZGVsLWRyb3Bkb3duIGRyb3Bkb3duJyB9KTtcbiAgICAgICAgbW9kZWxEcm9wZG93bi5zdHlsZS5jc3NUZXh0ID0gJ3BhZGRpbmc6IDRweCAzMnB4IDRweCAxMnB4OyBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcik7IGJvcmRlci1yYWRpdXM6IDRweDsgYmFja2dyb3VuZDogdmFyKC0tYmFja2dyb3VuZC1wcmltYXJ5KTsgY29sb3I6IHZhcigtLXRleHQtbm9ybWFsKTsgZm9udC1zaXplOiB2YXIoLS1mb250LXNtYWxsZXIpOyBsaW5lLWhlaWdodDogMS41OyBjdXJzb3I6IHBvaW50ZXI7IG1pbi13aWR0aDogMTQwcHg7IHdpZHRoOiBmaXQtY29udGVudDsgbWF4LXdpZHRoOiAzMDBweDsgaGVpZ2h0OiBhdXRvOyc7XG5cbiAgICAgICAgbGV0IGFkdmFuY2VkQnV0dG9uOiBIVE1MQnV0dG9uRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICAgICAgICBsZXQgY29uZmlnVGV4dGFyZWE6IEhUTUxUZXh0QXJlYUVsZW1lbnQgfCBudWxsID0gbnVsbDtcbiAgICAgICAgbGV0IGNvbmZpZ0Rpc3BsYXk6IEhUTUxEaXZFbGVtZW50IHwgbnVsbCA9IG51bGw7XG5cbiAgICAgICAgaWYgKHRoaXMuYmxvY2tTZXR0aW5ncy5oYXNZYW1sKSB7XG4gICAgICAgICAgICBhZHZhbmNlZEJ1dHRvbiA9IGNvbnRyb2xzUm93LmNyZWF0ZUVsKCdidXR0b24nLCB7IGNsczogJ29sbGFtYS1hZHZhbmNlZC1idXR0b24nIH0pO1xuICAgICAgICAgICAgc2V0SWNvbihhZHZhbmNlZEJ1dHRvbiwgJ3NldHRpbmdzJyk7XG4gICAgICAgICAgICBhZHZhbmNlZEJ1dHRvbi5zdHlsZS5jc3NUZXh0ID0gJ3BhZGRpbmc6IDRweDsgYm9yZGVyOiBub25lOyBib3JkZXItcmFkaXVzOiA0cHg7IGN1cnNvcjogcG9pbnRlcjsgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBtYXJnaW4tbGVmdDogNHB4Oyc7XG4gICAgICAgICAgICBhZHZhbmNlZEJ1dHRvbi50aXRsZSA9ICdBZHZhbmNlZCBTZXR0aW5ncyc7XG5cbiAgICAgICAgICAgIGNvbmZpZ0Rpc3BsYXkgPSBjb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiAnb2xsYW1hLWNvbmZpZy1kaXNwbGF5JyB9KTtcbiAgICAgICAgICAgIGNvbmZpZ0Rpc3BsYXkuc3R5bGUuY3NzVGV4dCA9ICdkaXNwbGF5OiBub25lOyBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLXByaW1hcnkpOyBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcik7IGJvcmRlci1yYWRpdXM6IDRweDsgcGFkZGluZzogMTJweDsgbWFyZ2luLWJvdHRvbTogMTJweDsgZm9udC1zaXplOiB2YXIoLS1mb250LXNtYWxsZXIpOyc7XG5cbiAgICAgICAgICAgIGNvbmZpZ1RleHRhcmVhID0gY29uZmlnRGlzcGxheS5jcmVhdGVFbCgndGV4dGFyZWEnLCB7IGF0dHI6IHsgcm93czogOCwgcGxhY2Vob2xkZXI6ICdZQU1MIGNvbmZpZ3VyYXRpb24uLi4nIH0gfSk7XG4gICAgICAgICAgICBjb25maWdUZXh0YXJlYS5zdHlsZS5jc3NUZXh0ID0gJ3dpZHRoOiAxMDAlOyBwYWRkaW5nOiA4cHg7IGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyKTsgYm9yZGVyLXJhZGl1czogNHB4OyBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLXByaW1hcnkpOyBjb2xvcjogdmFyKC0tdGV4dC1ub3JtYWwpOyByZXNpemU6IHZlcnRpY2FsOyBmb250LWZhbWlseTogdmFyKC0tZm9udC1tb25vc3BhY2UpOyBmb250LXNpemU6IHZhcigtLWZvbnQtc21hbGxlcik7JztcbiAgICAgICAgICAgIGNvbmZpZ1RleHRhcmVhLnZhbHVlID0gdGhpcy5tYW5hZ2VyLmdlbmVyYXRlWWFtbEZyb21Db25maWcodGhpcy5ibG9ja1NldHRpbmdzLnlhbWxDb25maWcpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcHJvbXB0Q29udGFpbmVyID0gY29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogJ29sbGFtYS1wcm9tcHQtY29udGFpbmVyJyB9KTtcbiAgICAgICAgcHJvbXB0Q29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSAncG9zaXRpb246IHJlbGF0aXZlOyB3aWR0aDogMTAwJTsgbWFyZ2luLWJvdHRvbTogMTJweDsnO1xuXG4gICAgICAgIGNvbnN0IHByb21wdElucHV0ID0gcHJvbXB0Q29udGFpbmVyLmNyZWF0ZUVsKCdkaXYnLCB7IGNsczogJ29sbGFtYS1wcm9tcHQtaW5wdXQnLCBhdHRyOiB7IGNvbnRlbnRlZGl0YWJsZTogJ3RydWUnLCAnZGF0YS1wbGFjZWhvbGRlcic6ICdFbnRlciBwcm9tcHQuLi4nIH0gfSk7XG4gICAgICAgIHByb21wdElucHV0LmlubmVySFRNTCA9IHRoaXMuYmxvY2tTZXR0aW5ncy5wcm9tcHQ7XG4gICAgICAgIHByb21wdElucHV0LnN0eWxlLmNzc1RleHQgPSAnd2lkdGg6IDEwMCU7IHBhZGRpbmc6IDEycHg7IHBhZGRpbmctYm90dG9tOiA0NXB4OyBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcik7IGJvcmRlci1yYWRpdXM6IDhweDsgYmFja2dyb3VuZDogdmFyKC0tYmFja2dyb3VuZC1wcmltYXJ5KTsgY29sb3I6IHZhcigtLXRleHQtbm9ybWFsKTsgb3ZlcmZsb3c6IGF1dG87IG1pbi1oZWlnaHQ6IDEwMHB4OyB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7IHdvcmQtd3JhcDogYnJlYWstd29yZDsgb3V0bGluZTogbm9uZTsgdHJhbnNpdGlvbjogYm9yZGVyLWNvbG9yIDAuMnM7JztcbiAgICAgICAgcHJvbXB0SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCAoKSA9PiBwcm9tcHRJbnB1dC5zdHlsZS5ib3JkZXJDb2xvciA9ICd2YXIoLS1pbnRlcmFjdGl2ZS1hY2NlbnQpJyk7XG4gICAgICAgIHByb21wdElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCAoKSA9PiBwcm9tcHRJbnB1dC5zdHlsZS5ib3JkZXJDb2xvciA9ICd2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlciknKTtcblxuICAgICAgICBjb25zdCBhY3Rpb25CdXR0b25zID0gcHJvbXB0Q29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogJ29sbGFtYS1hY3Rpb24tYnV0dG9ucycgfSk7XG4gICAgICAgIGFjdGlvbkJ1dHRvbnMuc3R5bGUuY3NzVGV4dCA9ICdwb3NpdGlvbjogYWJzb2x1dGU7IGJvdHRvbTogMTBweDsgcmlnaHQ6IDEwcHg7IGRpc3BsYXk6IGZsZXg7IGdhcDogOHB4OyBhbGlnbi1pdGVtczogY2VudGVyOyc7XG5cbiAgICAgICAgY29uc3QgY29weUJ1dHRvbiA9IGFjdGlvbkJ1dHRvbnMuY3JlYXRlRWwoJ2J1dHRvbicsIHsgY2xzOiAnb2xsYW1hLWNvcHktYnV0dG9uJyB9KTtcbiAgICAgICAgc2V0SWNvbihjb3B5QnV0dG9uLCAnY29weScpO1xuICAgICAgICBjb3B5QnV0dG9uLnN0eWxlLmNzc1RleHQgPSAnd2lkdGg6IDQycHg7IGhlaWdodDogNDJweDsgYm9yZGVyOiBub25lOyBib3JkZXItcmFkaXVzOiA1MCU7IGN1cnNvcjogcG9pbnRlcjsgYmFja2dyb3VuZDogdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpOyBvcGFjaXR5OiAwLjk7IHRyYW5zaXRpb246IGFsbCAwLjJzOyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsgY29sb3I6IHZhcigtLXRleHQtbm9ybWFsKTsnO1xuICAgICAgICBjb3B5QnV0dG9uLnRpdGxlID0gJ0NvcHkgcHJvbXB0JztcbiAgICAgICAgY29uc3QgY29weUljb24gPSBjb3B5QnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJ3N2ZycpO1xuICAgICAgICBpZiAoY29weUljb24pIHsgY29weUljb24uc3R5bGUud2lkdGggPSAnMjhweCc7IGNvcHlJY29uLnN0eWxlLmhlaWdodCA9ICcyOHB4JzsgfVxuXG4gICAgICAgIGNvcHlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsICgpID0+IHtcbiAgICAgICAgICAgIGNvcHlCdXR0b24uc3R5bGUub3BhY2l0eSA9ICcxJztcbiAgICAgICAgICAgIGNvcHlCdXR0b24uc3R5bGUuYmFja2dyb3VuZCA9ICd2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlci1ob3ZlciknO1xuICAgICAgICAgICAgY29weUJ1dHRvbi5zdHlsZS50cmFuc2Zvcm0gPSAnc2NhbGUoMS4wNSknO1xuICAgICAgICB9KTtcbiAgICAgICAgY29weUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgKCkgPT4ge1xuICAgICAgICAgICAgY29weUJ1dHRvbi5zdHlsZS5vcGFjaXR5ID0gJzAuOSc7XG4gICAgICAgICAgICBjb3B5QnV0dG9uLnN0eWxlLmJhY2tncm91bmQgPSAndmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpJztcbiAgICAgICAgICAgIGNvcHlCdXR0b24uc3R5bGUudHJhbnNmb3JtID0gJ3NjYWxlKDEpJztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3Qgc2F2ZUJ1dHRvbiA9IGFjdGlvbkJ1dHRvbnMuY3JlYXRlRWwoJ2J1dHRvbicsIHsgY2xzOiAnb2xsYW1hLXNhdmUtYnV0dG9uJyB9KTtcbiAgICAgICAgc2V0SWNvbihzYXZlQnV0dG9uLCAnc2F2ZScpO1xuICAgICAgICBzYXZlQnV0dG9uLnN0eWxlLmNzc1RleHQgPSAnd2lkdGg6IDQycHg7IGhlaWdodDogNDJweDsgYm9yZGVyOiBub25lOyBib3JkZXItcmFkaXVzOiA1MCU7IGN1cnNvcjogcG9pbnRlcjsgYmFja2dyb3VuZDogdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpOyBvcGFjaXR5OiAwLjk7IHRyYW5zaXRpb246IGFsbCAwLjJzOyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsgY29sb3I6IHZhcigtLXRleHQtbm9ybWFsKTsnO1xuICAgICAgICBzYXZlQnV0dG9uLnRpdGxlID0gJ1NhdmUgcHJvbXB0IChDdHJsK1MpJztcbiAgICAgICAgY29uc3Qgc2F2ZUljb24gPSBzYXZlQnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJ3N2ZycpO1xuICAgICAgICBpZiAoc2F2ZUljb24pIHsgc2F2ZUljb24uc3R5bGUud2lkdGggPSAnMjRweCc7IHNhdmVJY29uLnN0eWxlLmhlaWdodCA9ICcyNHB4JzsgfVxuXG4gICAgICAgIHNhdmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsICgpID0+IHtcbiAgICAgICAgICAgIHNhdmVCdXR0b24uc3R5bGUub3BhY2l0eSA9ICcxJztcbiAgICAgICAgICAgIHNhdmVCdXR0b24uc3R5bGUuYmFja2dyb3VuZCA9ICd2YXIoLS1pbnRlcmFjdGl2ZS1hY2NlbnQpJztcbiAgICAgICAgICAgIHNhdmVCdXR0b24uc3R5bGUuY29sb3IgPSAndmFyKC0tdGV4dC1vbi1hY2NlbnQpJztcbiAgICAgICAgICAgIHNhdmVCdXR0b24uc3R5bGUudHJhbnNmb3JtID0gJ3NjYWxlKDEuMDUpJztcbiAgICAgICAgfSk7XG4gICAgICAgIHNhdmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsICgpID0+IHtcbiAgICAgICAgICAgIHNhdmVCdXR0b24uc3R5bGUub3BhY2l0eSA9ICcwLjknO1xuICAgICAgICAgICAgc2F2ZUJ1dHRvbi5zdHlsZS5iYWNrZ3JvdW5kID0gJ3ZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyKSc7XG4gICAgICAgICAgICBzYXZlQnV0dG9uLnN0eWxlLmNvbG9yID0gJ3ZhcigtLXRleHQtbm9ybWFsKSc7XG4gICAgICAgICAgICBzYXZlQnV0dG9uLnN0eWxlLnRyYW5zZm9ybSA9ICdzY2FsZSgxKSc7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGNsZWFyQnV0dG9uID0gYWN0aW9uQnV0dG9ucy5jcmVhdGVFbCgnYnV0dG9uJywgeyBjbHM6ICdvbGxhbWEtY2xlYXItYnV0dG9uJyB9KTtcbiAgICAgICAgc2V0SWNvbihjbGVhckJ1dHRvbiwgJ3RyYXNoJyk7XG4gICAgICAgIGNsZWFyQnV0dG9uLnN0eWxlLmNzc1RleHQgPSAnd2lkdGg6IDQycHg7IGhlaWdodDogNDJweDsgYm9yZGVyOiBub25lOyBib3JkZXItcmFkaXVzOiA1MCU7IGN1cnNvcjogcG9pbnRlcjsgYmFja2dyb3VuZDogdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpOyBvcGFjaXR5OiAwLjk7IHRyYW5zaXRpb246IGFsbCAwLjJzOyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsgY29sb3I6IHZhcigtLXRleHQtbm9ybWFsKTsnO1xuICAgICAgICBjbGVhckJ1dHRvbi50aXRsZSA9ICdDbGVhciBwcm9tcHQnO1xuICAgICAgICBjb25zdCBjbGVhckljb24gPSBjbGVhckJ1dHRvbi5xdWVyeVNlbGVjdG9yKCdzdmcnKTtcbiAgICAgICAgaWYgKGNsZWFySWNvbikgeyBjbGVhckljb24uc3R5bGUud2lkdGggPSAnMjhweCc7IGNsZWFySWNvbi5zdHlsZS5oZWlnaHQgPSAnMjhweCc7IH1cblxuICAgICAgICBjbGVhckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgKCkgPT4ge1xuICAgICAgICAgICAgY2xlYXJCdXR0b24uc3R5bGUub3BhY2l0eSA9ICcxJztcbiAgICAgICAgICAgIGNsZWFyQnV0dG9uLnN0eWxlLmJhY2tncm91bmQgPSAndmFyKC0tdGV4dC1lcnJvciknO1xuICAgICAgICAgICAgY2xlYXJCdXR0b24uc3R5bGUuY29sb3IgPSAnd2hpdGUnO1xuICAgICAgICAgICAgY2xlYXJCdXR0b24uc3R5bGUudHJhbnNmb3JtID0gJ3NjYWxlKDEuMDUpJztcbiAgICAgICAgfSk7XG4gICAgICAgIGNsZWFyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCAoKSA9PiB7XG4gICAgICAgICAgICBjbGVhckJ1dHRvbi5zdHlsZS5vcGFjaXR5ID0gJzAuOSc7XG4gICAgICAgICAgICBjbGVhckJ1dHRvbi5zdHlsZS5iYWNrZ3JvdW5kID0gJ3ZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyKSc7XG4gICAgICAgICAgICBjbGVhckJ1dHRvbi5zdHlsZS5jb2xvciA9ICd2YXIoLS10ZXh0LW5vcm1hbCknO1xuICAgICAgICAgICAgY2xlYXJCdXR0b24uc3R5bGUudHJhbnNmb3JtID0gJ3NjYWxlKDEpJztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3Qgc3VibWl0QnV0dG9uID0gYWN0aW9uQnV0dG9ucy5jcmVhdGVFbCgnYnV0dG9uJywgeyBjbHM6ICdvbGxhbWEtc3VibWl0LWJ1dHRvbiBtb2QtY3RhJyB9KTtcbiAgICAgICAgc2V0SWNvbihzdWJtaXRCdXR0b24sICdzZW5kJyk7XG4gICAgICAgIHN1Ym1pdEJ1dHRvbi5zdHlsZS5jc3NUZXh0ID0gJ3dpZHRoOiA0MnB4OyBoZWlnaHQ6IDQycHg7IGJvcmRlcjogbm9uZTsgYm9yZGVyLXJhZGl1czogNTAlOyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsgY3Vyc29yOiBwb2ludGVyOyB0cmFuc2l0aW9uOiBhbGwgMC4yczsgcGFkZGluZzogMDsnO1xuICAgICAgICBzdWJtaXRCdXR0b24udGl0bGUgPSAnR2VuZXJhdGUgKEVudGVyKSc7XG4gICAgICAgIGNvbnN0IHN1Ym1pdEljb24gPSBzdWJtaXRCdXR0b24ucXVlcnlTZWxlY3Rvcignc3ZnJyk7XG4gICAgICAgIGlmIChzdWJtaXRJY29uKSB7IHN1Ym1pdEljb24uc3R5bGUud2lkdGggPSAnMjBweCc7IHN1Ym1pdEljb24uc3R5bGUuaGVpZ2h0ID0gJzIwcHgnOyB9XG5cbiAgICAgICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gY29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogJ29sbGFtYS1idXR0b24tY29udGFpbmVyJyB9KTtcbiAgICAgICAgYnV0dG9uQ29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSAnZGlzcGxheTogZmxleDsgZ2FwOiAxMHB4OyBhbGlnbi1pdGVtczogY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtc3RhcnQ7JztcblxuICAgICAgICBjb25zdCByZXNwb25zZXNDb250YWluZXIgPSBidXR0b25Db250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiAnb2xsYW1hLXJlc3BvbnNlcy1jb250cm9sJyB9KTtcbiAgICAgICAgcmVzcG9uc2VzQ29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSAnZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiA4cHg7IG1hcmdpbi1sZWZ0OiBhdXRvOyc7XG4gICAgICAgIHJlc3BvbnNlc0NvbnRhaW5lci5jcmVhdGVFbCgnbGFiZWwnLCB7IHRleHQ6ICdSZXNwb25zZXM6JywgY2xzOiAnc2V0dGluZy1pdGVtLW5hbWUnIH0pLnN0eWxlLmNzc1RleHQgPSAnZm9udC1zaXplOiB2YXIoLS1mb250LXNtYWxsZXIpOyc7XG5cbiAgICAgICAgY29uc3QgaW5pdGlhbFJlc3BvbnNlcyA9IHRoaXMuYmxvY2tTZXR0aW5ncy55YW1sQ29uZmlnLm51bV9yZXNwb25zZXMgfHwgMTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2VzU2xpZGVyID0gcmVzcG9uc2VzQ29udGFpbmVyLmNyZWF0ZUVsKCdpbnB1dCcsIHsgY2xzOiAnb2xsYW1hLXJlc3BvbnNlcy1zbGlkZXInLCBhdHRyOiB7IHR5cGU6ICdyYW5nZScsIG1pbjogJzEnLCBtYXg6ICcyMCcsIHZhbHVlOiBpbml0aWFsUmVzcG9uc2VzLnRvU3RyaW5nKCksIHN0ZXA6ICcxJyB9IH0pO1xuICAgICAgICByZXNwb25zZXNTbGlkZXIuc3R5bGUuY3NzVGV4dCA9ICd3aWR0aDogMTAwcHg7IGN1cnNvcjogcG9pbnRlcjsnO1xuXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlc0lucHV0ID0gcmVzcG9uc2VzQ29udGFpbmVyLmNyZWF0ZUVsKCdpbnB1dCcsIHsgY2xzOiAnb2xsYW1hLXJlc3BvbnNlcy1pbnB1dCcsIGF0dHI6IHsgdHlwZTogJ251bWJlcicsIG1pbjogJzEnLCBtYXg6ICcyMCcsIHZhbHVlOiBpbml0aWFsUmVzcG9uc2VzLnRvU3RyaW5nKCkgfSB9KTtcbiAgICAgICAgcmVzcG9uc2VzSW5wdXQuc3R5bGUuY3NzVGV4dCA9ICd3aWR0aDogNTBweDsgcGFkZGluZzogNHB4IDhweDsgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpOyBib3JkZXItcmFkaXVzOiA0cHg7IGJhY2tncm91bmQ6IHZhcigtLWJhY2tncm91bmQtcHJpbWFyeSk7IGNvbG9yOiB2YXIoLS10ZXh0LW5vcm1hbCk7IGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zbWFsbGVyKTsnO1xuXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlc1dyYXBwZXIgPSBjb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiAnb2xsYW1hLXJlc3BvbnNlcy13cmFwcGVyJyB9KTtcbiAgICAgICAgcmVzcG9uc2VzV3JhcHBlci5zdHlsZS5jc3NUZXh0ID0gJ21hcmdpbi10b3A6IDEycHg7IGRpc3BsYXk6IG5vbmU7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IGdhcDogOHB4Oyc7XG5cbiAgICAgICAgdGhpcy5jb21wb25lbnRzID0geyBwcm92aWRlckRyb3Bkb3duLCBtb2RlbERyb3Bkb3duLCBhZHZhbmNlZEJ1dHRvbiwgY29uZmlnRGlzcGxheSwgY29uZmlnVGV4dGFyZWEsIHJlc3BvbnNlc1NsaWRlciwgcmVzcG9uc2VzSW5wdXQsIHByb21wdElucHV0LCBjb3B5QnV0dG9uLCBjbGVhckJ1dHRvbiwgc3VibWl0QnV0dG9uLCBzYXZlQnV0dG9uLCByZXNwb25zZXNXcmFwcGVyIH07XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpbml0aWFsaXplQ29udHJvbGxlcigpIHtcbiAgICAgICAgY29uc3QgeyBwcm92aWRlckRyb3Bkb3duLCBtb2RlbERyb3Bkb3duLCBhZHZhbmNlZEJ1dHRvbiwgY29uZmlnRGlzcGxheSwgY29uZmlnVGV4dGFyZWEsIHJlc3BvbnNlc1NsaWRlciwgcmVzcG9uc2VzSW5wdXQsIHByb21wdElucHV0LCBjb3B5QnV0dG9uLCBjbGVhckJ1dHRvbiwgc3VibWl0QnV0dG9uLCBzYXZlQnV0dG9uLCByZXNwb25zZXNXcmFwcGVyIH0gPSB0aGlzLmNvbXBvbmVudHM7XG4gICAgICAgIGxldCBhYm9ydENvbnRyb2xsZXI6IEFib3J0Q29udHJvbGxlciB8IG51bGwgPSBudWxsO1xuICAgICAgICBsZXQgaXNHZW5lcmF0aW5nID0gZmFsc2U7XG5cbiAgICAgICAgY29uc3QgdXBkYXRlU3VibWl0QnV0dG9uU3RhdGUgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBoYXNDb250ZW50ID0gcHJvbXB0SW5wdXQuaW5uZXJUZXh0LnRyaW0oKS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgaWYgKGlzR2VuZXJhdGluZykge1xuICAgICAgICAgICAgICAgIHN1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHN1Ym1pdEJ1dHRvbi5zdHlsZS5vcGFjaXR5ID0gJzEnO1xuICAgICAgICAgICAgICAgIHN1Ym1pdEJ1dHRvbi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAndmFyKC0tdGV4dC1lcnJvciknO1xuICAgICAgICAgICAgICAgIHN1Ym1pdEJ1dHRvbi5zdHlsZS5jb2xvciA9ICd3aGl0ZSc7XG4gICAgICAgICAgICAgICAgc2V0SWNvbihzdWJtaXRCdXR0b24sICdzcXVhcmUnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBpY29uID0gc3VibWl0QnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJ3N2ZycpO1xuICAgICAgICAgICAgICAgIGlmIChpY29uKSB7IGljb24uc3R5bGUud2lkdGggPSAnMTRweCc7IGljb24uc3R5bGUuaGVpZ2h0ID0gJzE0cHgnOyB9XG4gICAgICAgICAgICAgICAgc3VibWl0QnV0dG9uLnRpdGxlID0gJ1N0b3AgZ2VuZXJhdGluZyc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHN1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9ICFoYXNDb250ZW50O1xuICAgICAgICAgICAgICAgIHN1Ym1pdEJ1dHRvbi5zdHlsZS5vcGFjaXR5ID0gaGFzQ29udGVudCA/ICcxJyA6ICcwLjQnO1xuICAgICAgICAgICAgICAgIHN1Ym1pdEJ1dHRvbi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBoYXNDb250ZW50ID8gJ3ZhcigtLWludGVyYWN0aXZlLWFjY2VudCknIDogJ3ZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyKSc7XG4gICAgICAgICAgICAgICAgc3VibWl0QnV0dG9uLnN0eWxlLmNvbG9yID0gaGFzQ29udGVudCA/ICd2YXIoLS10ZXh0LW9uLWFjY2VudCknIDogJ3ZhcigtLXRleHQtbXV0ZWQpJztcbiAgICAgICAgICAgICAgICBzZXRJY29uKHN1Ym1pdEJ1dHRvbiwgJ3NlbmQnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBpY29uID0gc3VibWl0QnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJ3N2ZycpO1xuICAgICAgICAgICAgICAgIGlmIChpY29uKSB7IGljb24uc3R5bGUud2lkdGggPSAnMjBweCc7IGljb24uc3R5bGUuaGVpZ2h0ID0gJzIwcHgnOyB9XG4gICAgICAgICAgICAgICAgc3VibWl0QnV0dG9uLnRpdGxlID0gaGFzQ29udGVudCA/ICdHZW5lcmF0ZSAoRW50ZXIpJyA6ICdFbnRlciBwcm9tcHQgdG8gZ2VuZXJhdGUnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHVwZGF0ZVN1Ym1pdEJ1dHRvblN0YXRlKCk7XG5cbiAgICAgICAgY29uc3QgcG9wdWxhdGVNb2RlbHMgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb3ZpZGVySWQgPSBwcm92aWRlckRyb3Bkb3duLnZhbHVlO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb3ZpZGVyID0gdGhpcy5zZXJ2aWNlLmdldFByb3ZpZGVyKHByb3ZpZGVySWQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHByb3ZpZGVyLmZldGNoTW9kZWxzKCk7XG5cbiAgICAgICAgICAgICAgICBtb2RlbERyb3Bkb3duLmlubmVySFRNTCA9ICcnO1xuICAgICAgICAgICAgICAgIHJlcy5tb2RlbHMuZm9yRWFjaCgobTogTExNTW9kZWwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbW9kZWxEcm9wZG93bi5jcmVhdGVFbCgnb3B0aW9uJywgeyB2YWx1ZTogbS5pZCwgdGV4dDogbS5uYW1lIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgY29uc3Qgc2F2ZWRNb2RlbCA9IHRoaXMuYmxvY2tTZXR0aW5ncy55YW1sQ29uZmlnLm1vZGVsO1xuICAgICAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRNb2RlbCA9IHByb3ZpZGVySWQgPT09ICdvbGxhbWEnID8gdGhpcy5zZXJ2aWNlLmdldFNldHRpbmdzKCkub2xsYW1hLm1vZGVsIDogdGhpcy5zZXJ2aWNlLmdldFNldHRpbmdzKCkub3BlbmFpLm1vZGVsO1xuXG4gICAgICAgICAgICAgICAgbW9kZWxEcm9wZG93bi52YWx1ZSA9IHNhdmVkTW9kZWwgfHwgZGVmYXVsdE1vZGVsO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoJ0ZhaWxlZCB0byBsb2FkIG1vZGVscyBmb3Igc2VsZWN0ZWQgcHJvdmlkZXInKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBwb3B1bGF0ZU1vZGVscygpO1xuXG4gICAgICAgIHByb3ZpZGVyRHJvcGRvd24uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcHJvdmlkZXJJZCA9IHByb3ZpZGVyRHJvcGRvd24udmFsdWUgYXMgUHJvdmlkZXJUeXBlO1xuICAgICAgICAgICAgdGhpcy5ibG9ja1NldHRpbmdzLnlhbWxDb25maWcucHJvdmlkZXIgPSBwcm92aWRlcklkO1xuICAgICAgICAgICAgdGhpcy5ibG9ja1NldHRpbmdzLnlhbWxDb25maWcubW9kZWwgPSAnJzsgLy8gUmVzZXQgbW9kZWwgb24gcHJvdmlkZXIgY2hhbmdlXG5cbiAgICAgICAgICAgIGNvbnN0IG5ld1lhbWwgPSB0aGlzLm1hbmFnZXIuZ2VuZXJhdGVZYW1sRnJvbUNvbmZpZyh0aGlzLmJsb2NrU2V0dGluZ3MueWFtbENvbmZpZyk7XG4gICAgICAgICAgICB0aGlzLm1hbmFnZXIudXBkYXRlRmlsZUJsb2NrKHRoaXMuZWwsIHRoaXMuY3R4LCBwcm9tcHRJbnB1dC5pbm5lclRleHQudHJpbSgpLCBuZXdZYW1sKTtcbiAgICAgICAgICAgIGlmIChjb25maWdUZXh0YXJlYSkgY29uZmlnVGV4dGFyZWEudmFsdWUgPSBuZXdZYW1sO1xuXG4gICAgICAgICAgICBhd2FpdCBwb3B1bGF0ZU1vZGVscygpO1xuICAgICAgICB9KTtcblxuICAgICAgICBtb2RlbERyb3Bkb3duLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYmxvY2tTZXR0aW5ncy55YW1sQ29uZmlnLm1vZGVsID0gbW9kZWxEcm9wZG93bi52YWx1ZTtcbiAgICAgICAgICAgIGNvbnN0IG5ld1lhbWwgPSB0aGlzLm1hbmFnZXIuZ2VuZXJhdGVZYW1sRnJvbUNvbmZpZyh0aGlzLmJsb2NrU2V0dGluZ3MueWFtbENvbmZpZyk7XG4gICAgICAgICAgICB0aGlzLm1hbmFnZXIudXBkYXRlRmlsZUJsb2NrKHRoaXMuZWwsIHRoaXMuY3R4LCBwcm9tcHRJbnB1dC5pbm5lclRleHQudHJpbSgpLCBuZXdZYW1sKTtcbiAgICAgICAgICAgIGlmIChjb25maWdUZXh0YXJlYSkgY29uZmlnVGV4dGFyZWEudmFsdWUgPSBuZXdZYW1sO1xuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoY29weUJ1dHRvbikge1xuICAgICAgICAgICAgY29weUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0ID0gcHJvbXB0SW5wdXQuaW5uZXJUZXh0LnRyaW0oKTtcbiAgICAgICAgICAgICAgICBpZiAodGV4dCkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dCh0ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnUHJvbXB0IGNvcGllZCB0byBjbGlwYm9hcmQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjbGVhckJ1dHRvbikge1xuICAgICAgICAgICAgY2xlYXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcHJvbXB0SW5wdXQuaW5uZXJUZXh0ID0gJyc7XG4gICAgICAgICAgICAgICAgdXBkYXRlU3VibWl0QnV0dG9uU3RhdGUoKTtcbiAgICAgICAgICAgICAgICBjb25zdCB5YW1sID0gdGhpcy5ibG9ja1NldHRpbmdzLmhhc1lhbWwgPyBjb25maWdUZXh0YXJlYS52YWx1ZSA6ICcnO1xuICAgICAgICAgICAgICAgIHRoaXMubWFuYWdlci51cGRhdGVGaWxlQmxvY2sodGhpcy5lbCwgdGhpcy5jdHgsICcnLCB5YW1sKTtcbiAgICAgICAgICAgICAgICBuZXcgTm90aWNlKCdQcm9tcHQgY2xlYXJlZCcpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYWR2YW5jZWRCdXR0b24pIHtcbiAgICAgICAgICAgIGFkdmFuY2VkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGlzSGlkZGVuID0gY29uZmlnRGlzcGxheS5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZSc7XG4gICAgICAgICAgICAgICAgY29uZmlnRGlzcGxheS5zdHlsZS5kaXNwbGF5ID0gaXNIaWRkZW4gPyAnYmxvY2snIDogJ25vbmUnO1xuICAgICAgICAgICAgICAgIGFkdmFuY2VkQnV0dG9uLnN0eWxlLmJhY2tncm91bmQgPSBpc0hpZGRlbiA/ICd2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWFjdGl2ZS1ob3ZlciknIDogJ3RyYW5zcGFyZW50JztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uZmlnVGV4dGFyZWEuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm1hbmFnZXIudXBkYXRlRmlsZUJsb2NrKHRoaXMuZWwsIHRoaXMuY3R4LCBwcm9tcHRJbnB1dC5pbm5lclRleHQudHJpbSgpLCBjb25maWdUZXh0YXJlYS52YWx1ZS50cmltKCkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB1cGRhdGVSZXNwb25zZUNvdW50ID0gdGhpcy5kZWJvdW5jZSgodmFsOiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYmxvY2tTZXR0aW5ncy55YW1sQ29uZmlnLm51bV9yZXNwb25zZXMgPSB2YWw7XG4gICAgICAgICAgICBjb25zdCBuZXdZYW1sID0gdGhpcy5tYW5hZ2VyLmdlbmVyYXRlWWFtbEZyb21Db25maWcodGhpcy5ibG9ja1NldHRpbmdzLnlhbWxDb25maWcpO1xuICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLnVwZGF0ZUZpbGVCbG9jayh0aGlzLmVsLCB0aGlzLmN0eCwgcHJvbXB0SW5wdXQuaW5uZXJUZXh0LnRyaW0oKSwgbmV3WWFtbCk7XG4gICAgICAgICAgICBpZiAoY29uZmlnVGV4dGFyZWEpIGNvbmZpZ1RleHRhcmVhLnZhbHVlID0gbmV3WWFtbDtcbiAgICAgICAgfSwgMTAwMCk7XG5cbiAgICAgICAgcmVzcG9uc2VzU2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCkgPT4ge1xuICAgICAgICAgICAgcmVzcG9uc2VzSW5wdXQudmFsdWUgPSByZXNwb25zZXNTbGlkZXIudmFsdWU7XG4gICAgICAgICAgICB1cGRhdGVSZXNwb25zZUNvdW50KHBhcnNlSW50KHJlc3BvbnNlc1NsaWRlci52YWx1ZSkpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVzcG9uc2VzSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKSA9PiB7XG4gICAgICAgICAgICByZXNwb25zZXNTbGlkZXIudmFsdWUgPSByZXNwb25zZXNJbnB1dC52YWx1ZTtcbiAgICAgICAgICAgIHVwZGF0ZVJlc3BvbnNlQ291bnQocGFyc2VJbnQocmVzcG9uc2VzSW5wdXQudmFsdWUpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3Qgc3RhcnRHZW5lcmF0aW9uID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGlzR2VuZXJhdGluZykge1xuICAgICAgICAgICAgICAgIGFib3J0Q29udHJvbGxlcj8uYWJvcnQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHByb21wdCA9IHByb21wdElucHV0LmlubmVyVGV4dC50cmltKCk7XG4gICAgICAgICAgICBpZiAoIXByb21wdCkgcmV0dXJuO1xuXG4gICAgICAgICAgICBpc0dlbmVyYXRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgdXBkYXRlU3VibWl0QnV0dG9uU3RhdGUoKTtcblxuICAgICAgICAgICAgY29uc3QgY291bnQgPSBwYXJzZUludChyZXNwb25zZXNJbnB1dC52YWx1ZSkgfHwgMTtcbiAgICAgICAgICAgIHJlc3BvbnNlc1dyYXBwZXIuc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcbiAgICAgICAgICAgIHJlc3BvbnNlc1dyYXBwZXIuaW5uZXJIVE1MID0gJyc7XG5cbiAgICAgICAgICAgIGFib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgICAgICAgICAgIGNvbnN0IHByb3ZpZGVySWQgPSBwcm92aWRlckRyb3Bkb3duLnZhbHVlO1xuICAgICAgICAgICAgY29uc3QgcHJvdmlkZXIgPSB0aGlzLnNlcnZpY2UuZ2V0UHJvdmlkZXIocHJvdmlkZXJJZCk7XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSByZXNwb25zZXNXcmFwcGVyLmNyZWF0ZURpdih7IGNsczogJ29sbGFtYS1yZXNwb25zZS1pdGVtJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5zdHlsZS5jc3NUZXh0ID0gJ2JhY2tncm91bmQ6IHZhcigtLWJhY2tncm91bmQtcHJpbWFyeSk7IGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyKTsgYm9yZGVyLXJhZGl1czogOHB4OyBwYWRkaW5nOiAxMnB4OyBtYXJnaW4tYm90dG9tOiA4cHg7JztcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGl0ZW0uY3JlYXRlRGl2KCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG91dHB1dFByZSA9IGNvbnRlbnQuY3JlYXRlRWwoJ3ByZScsIHsgY2xzOiAnb2xsYW1hLW91dHB1dCcgfSk7XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dFByZS5zdHlsZS5jc3NUZXh0ID0gJ3doaXRlLXNwYWNlOiBwcmUtd3JhcDsgZm9udC1zaXplOiB2YXIoLS1mb250LXNtYWxsZXIpOyBmb250LWZhbWlseTogdmFyKC0tZm9udC1tb25vc3BhY2UpOyc7XG5cbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzdGF0c1Nob3duID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmb290ZXJDb250YWluZXIgPSBpdGVtLmNyZWF0ZURpdih7IGNsczogJ29sbGFtYS1yZXNwb25zZS1mb290ZXInIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9vdGVyQ29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSAnZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBhbGlnbi1pdGVtczogZmxleC1lbmQ7IG1hcmdpbi10b3A6IDhweDsgYm9yZGVyLXRvcDogMXB4IHNvbGlkIHZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyKTsgcGFkZGluZy10b3A6IDRweDsgcG9zaXRpb246IHJlbGF0aXZlOyc7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvcHlSZXNwQnV0dG9uID0gZm9vdGVyQ29udGFpbmVyLmNyZWF0ZUVsKCdidXR0b24nLCB7IGNsczogJ29sbGFtYS1yZXNwb25zZS1jb3B5LWJ1dHRvbicgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRJY29uKGNvcHlSZXNwQnV0dG9uLCAnY29weScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29weVJlc3BCdXR0b24uc3R5bGUuY3NzVGV4dCA9ICdwYWRkaW5nOiA0cHg7IGJvcmRlcjogbm9uZTsgYm9yZGVyLXJhZGl1czogNHB4OyBjdXJzb3I6IHBvaW50ZXI7IGJhY2tncm91bmQ6IHRyYW5zcGFyZW50OyBvcGFjaXR5OiAwLjM7IHRyYW5zaXRpb246IG9wYWNpdHkgMC4yczsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7JztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcHlSZXNwQnV0dG9uLnRpdGxlID0gJ0NvcHkgcmVzcG9uc2UnO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29weVJlc3BCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsICgpID0+IGNvcHlSZXNwQnV0dG9uLnN0eWxlLm9wYWNpdHkgPSAnMScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29weVJlc3BCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsICgpID0+IGNvcHlSZXNwQnV0dG9uLnN0eWxlLm9wYWNpdHkgPSAnMC4zJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb3B5UmVzcEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChvdXRwdXRQcmUudGV4dENvbnRlbnQgfHwgJycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoJ1Jlc3BvbnNlIGNvcGllZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRzRGl2ID0gZm9vdGVyQ29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogJ29sbGFtYS1zdGF0cycgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0c0Rpdi5zdHlsZS5jc3NUZXh0ID0gJ2ZvbnQtc2l6ZTogMTBweDsgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOyc7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHByb3ZpZGVyLnN0cmVhbVJlc3BvbnNlKHByb21wdCwgbW9kZWxEcm9wZG93bi52YWx1ZSwgdGhpcy5ibG9ja1NldHRpbmdzLnlhbWxDb25maWcsIGFib3J0Q29udHJvbGxlciwgKGNodW5rKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0UHJlLnRleHRDb250ZW50ICs9IGNodW5rO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgKGZpbmFsKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbmFsLnRvdGFsX2R1cmF0aW9uICYmICFzdGF0c1Nob3duKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzU2hvd24gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvblNlYyA9IChmaW5hbC50b3RhbF9kdXJhdGlvbiAvIDFlOSkudG9GaXhlZCgyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxUb2tlbnMgPSAoZmluYWwucHJvbXB0X2V2YWxfY291bnQgfHwgMCkgKyAoZmluYWwuZXZhbF9jb3VudCB8fCAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHNEaXYudGV4dENvbnRlbnQgPSBgVG9rZW5zOiAke3RvdGFsVG9rZW5zfSB8IFRpbWU6ICR7ZHVyYXRpb25TZWN9c2A7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLm5hbWUgPT09ICdBYm9ydEVycm9yJykgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50LmNyZWF0ZURpdih7IHRleHQ6IGBFcnJvcjogJHtlLm1lc3NhZ2V9YCB9KS5zdHlsZS5jb2xvciA9ICd2YXIoLS10ZXh0LWVycm9yKSc7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICAgICAgaXNHZW5lcmF0aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdXBkYXRlU3VibWl0QnV0dG9uU3RhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBzdWJtaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdGFydEdlbmVyYXRpb24pO1xuXG4gICAgICAgIGNvbnN0IG1hbnVhbFNhdmUgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB5YW1sID0gdGhpcy5ibG9ja1NldHRpbmdzLmhhc1lhbWwgPyBjb25maWdUZXh0YXJlYS52YWx1ZSA6ICcnO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5tYW5hZ2VyLnVwZGF0ZUZpbGVCbG9jayh0aGlzLmVsLCB0aGlzLmN0eCwgcHJvbXB0SW5wdXQuaW5uZXJUZXh0LnRyaW0oKSwgeWFtbCk7XG4gICAgICAgICAgICBuZXcgTm90aWNlKCdTYXZlZCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNhdmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBtYW51YWxTYXZlKTtcblxuICAgICAgICBwcm9tcHRJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHtcbiAgICAgICAgICAgIHVwZGF0ZVN1Ym1pdEJ1dHRvblN0YXRlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHByb21wdElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB5YW1sID0gdGhpcy5ibG9ja1NldHRpbmdzLmhhc1lhbWwgPyBjb25maWdUZXh0YXJlYS52YWx1ZSA6ICcnO1xuICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLnVwZGF0ZUZpbGVCbG9jayh0aGlzLmVsLCB0aGlzLmN0eCwgcHJvbXB0SW5wdXQuaW5uZXJUZXh0LnRyaW0oKSwgeWFtbCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHByb21wdElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGUua2V5ID09PSAnRW50ZXInICYmICFlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHN0YXJ0R2VuZXJhdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSAmJiBlLmtleSA9PT0gJ3MnKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIG1hbnVhbFNhdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gVHJhY2sgZm9jdXMvY3Vyc29yIHBvc2l0aW9uXG4gICAgICAgIGNvbnN0IHRyYWNrRm9jdXMgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzZWN0aW9uID0gdGhpcy5jdHguZ2V0U2VjdGlvbkluZm8odGhpcy5lbCk7XG4gICAgICAgICAgICBpZiAoIXNlY3Rpb24pIHJldHVybjtcblxuICAgICAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gd2luZG93LmdldFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgaWYgKCFzZWxlY3Rpb24gfHwgc2VsZWN0aW9uLnJhbmdlQ291bnQgPT09IDApIHJldHVybjtcblxuICAgICAgICAgICAgY29uc3QgcmFuZ2UgPSBzZWxlY3Rpb24uZ2V0UmFuZ2VBdCgwKTtcbiAgICAgICAgICAgIGNvbnN0IHByZVJhbmdlID0gcmFuZ2UuY2xvbmVSYW5nZSgpO1xuICAgICAgICAgICAgcHJlUmFuZ2Uuc2VsZWN0Tm9kZUNvbnRlbnRzKHByb21wdElucHV0KTtcbiAgICAgICAgICAgIHByZVJhbmdlLnNldEVuZChyYW5nZS5zdGFydENvbnRhaW5lciwgcmFuZ2Uuc3RhcnRPZmZzZXQpO1xuICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gcHJlUmFuZ2UudG9TdHJpbmcoKS5sZW5ndGg7XG5cbiAgICAgICAgICAgIHRoaXMubWFuYWdlci5zZXNzaW9uRm9jdXMgPSB7XG4gICAgICAgICAgICAgICAgbGluZVN0YXJ0OiBzZWN0aW9uLmxpbmVTdGFydCxcbiAgICAgICAgICAgICAgICBjaDogb2Zmc2V0LFxuICAgICAgICAgICAgICAgIGZpbGU6IHRoaXMuY3R4LnNvdXJjZVBhdGhcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgcHJvbXB0SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0cmFja0ZvY3VzKTtcbiAgICAgICAgcHJvbXB0SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRyYWNrRm9jdXMpO1xuICAgICAgICBwcm9tcHRJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIHRyYWNrRm9jdXMpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVzdG9yZUZvY3VzKCkge1xuICAgICAgICBjb25zdCB7IHByb21wdElucHV0IH0gPSB0aGlzLmNvbXBvbmVudHM7XG4gICAgICAgIGNvbnN0IHNlY3Rpb24gPSB0aGlzLmN0eC5nZXRTZWN0aW9uSW5mbyh0aGlzLmVsKTtcbiAgICAgICAgY29uc3QgZm9jdXMgPSB0aGlzLm1hbmFnZXIuc2Vzc2lvbkZvY3VzO1xuXG4gICAgICAgIGlmIChzZWN0aW9uICYmIGZvY3VzLmxpbmVTdGFydCA9PT0gc2VjdGlvbi5saW5lU3RhcnQgJiYgZm9jdXMuZmlsZSA9PT0gdGhpcy5jdHguc291cmNlUGF0aCkge1xuICAgICAgICAgICAgcHJvbXB0SW5wdXQuZm9jdXMoKTtcbiAgICAgICAgICAgIGlmIChmb2N1cy5jaCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICBjb25zdCByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG5cbiAgICAgICAgICAgICAgICBsZXQgY3VycmVudE9mZnNldCA9IDA7XG4gICAgICAgICAgICAgICAgbGV0IHRhcmdldE5vZGU6IE5vZGUgfCBudWxsID0gbnVsbDtcbiAgICAgICAgICAgICAgICBsZXQgdGFyZ2V0T2Zmc2V0ID0gMDtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGZpbmROb2RlID0gKG5vZGU6IE5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IE5vZGUuVEVYVF9OT0RFKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsZW4gPSAobm9kZSBhcyBUZXh0KS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudE9mZnNldCArIGxlbiA+PSAoZm9jdXMuY2ggYXMgbnVtYmVyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldE5vZGUgPSBub2RlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldE9mZnNldCA9IChmb2N1cy5jaCBhcyBudW1iZXIpIC0gY3VycmVudE9mZnNldDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRPZmZzZXQgKz0gbGVuO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2RlLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmluZE5vZGUobm9kZS5jaGlsZE5vZGVzW2ldKSkgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBmaW5kTm9kZShwcm9tcHRJbnB1dCk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0Tm9kZSkge1xuICAgICAgICAgICAgICAgICAgICByYW5nZS5zZXRTdGFydCh0YXJnZXROb2RlLCB0YXJnZXRPZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICByYW5nZS5jb2xsYXBzZSh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uPy5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uPy5hZGRSYW5nZShyYW5nZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRmFsbGJhY2sgdG8gZW5kXG4gICAgICAgICAgICAgICAgICAgIHJhbmdlLnNlbGVjdE5vZGVDb250ZW50cyhwcm9tcHRJbnB1dCk7XG4gICAgICAgICAgICAgICAgICAgIHJhbmdlLmNvbGxhcHNlKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uPy5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uPy5hZGRSYW5nZShyYW5nZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkZWJvdW5jZShmbjogRnVuY3Rpb24sIHdhaXQ6IG51bWJlcikge1xuICAgICAgICBsZXQgdDogYW55O1xuICAgICAgICByZXR1cm4gKC4uLmFyZ3M6IGFueVtdKSA9PiB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodCk7XG4gICAgICAgICAgICB0ID0gc2V0VGltZW91dCgoKSA9PiBmbi5hcHBseSh0aGlzLCBhcmdzKSwgd2FpdCk7XG4gICAgICAgIH07XG4gICAgfVxufVxuIl19