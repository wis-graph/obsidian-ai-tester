import { Notice, setIcon } from 'obsidian';
export class OllamaBlockView {
    constructor(el, service, manager, ctx, blockSettings) {
        this.components = {};
        this.el = el;
        this.service = service;
        this.manager = manager;
        this.ctx = ctx;
        this.blockSettings = blockSettings;
    }
    render() {
        this.el.empty();
        this.createLayout();
        this.initializeController();
        this.restoreFocus();
    }
    createLayout() {
        const container = this.el.createDiv({ cls: 'ollama-container' });
        container.style.cssText = 'padding: 12px; background: var(--background-secondary); border-radius: 8px; margin: 10px 0;';
        const headerRow = container.createDiv({ cls: 'ollama-header' });
        headerRow.style.cssText = 'display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;';
        headerRow.createEl('label', { text: 'Prompt:', cls: 'setting-item-name' }).style.cssText = 'font-weight: 600; margin-right: 16px;';
        const controlsRow = headerRow.createDiv({ cls: 'ollama-controls' });
        controlsRow.style.cssText = 'display: flex; align-items: center; gap: 8px;';
        // Provider Selection
        const providerDropdown = controlsRow.createEl('select', { cls: 'ollama-provider-dropdown dropdown' });
        providerDropdown.style.cssText = 'padding: 4px 12px; border: 1px solid var(--background-modifier-border); border-radius: 4px; background: var(--background-primary); color: var(--text-normal); font-size: var(--font-smaller); cursor: pointer;';
        const providers = this.service.getEnabledProviders();
        providers.forEach(p => {
            providerDropdown.createEl('option', { value: p.id, text: p.name });
        });
        providerDropdown.value = this.blockSettings.yamlConfig.provider || this.service.getSettings().activeProvider;
        // Model Selection
        const modelLabel = controlsRow.createEl('label', { text: 'Model:', cls: 'setting-item-name' });
        modelLabel.style.cssText = 'font-size: var(--font-smaller); font-weight: 500; font-family: var(--font-interface); margin-left: 8px;';
        const modelDropdown = controlsRow.createEl('select', { cls: 'ollama-model-dropdown dropdown' });
        modelDropdown.style.cssText = 'padding: 4px 32px 4px 12px; border: 1px solid var(--background-modifier-border); border-radius: 4px; background: var(--background-primary); color: var(--text-normal); font-size: var(--font-smaller); line-height: 1.5; cursor: pointer; min-width: 140px; width: fit-content; max-width: 300px; height: auto;';
        let advancedButton = null;
        let configTextarea = null;
        let configDisplay = null;
        if (this.blockSettings.hasYaml) {
            advancedButton = controlsRow.createEl('button', { cls: 'ollama-advanced-button' });
            setIcon(advancedButton, 'settings');
            advancedButton.style.cssText = 'padding: 4px; border: none; border-radius: 4px; cursor: pointer; background: transparent; display: flex; align-items: center; justify-content: center; margin-left: 4px;';
            advancedButton.title = 'Advanced Settings';
            configDisplay = container.createDiv({ cls: 'ollama-config-display' });
            configDisplay.style.cssText = 'display: none; background: var(--background-primary); border: 1px solid var(--background-modifier-border); border-radius: 4px; padding: 12px; margin-bottom: 12px; font-size: var(--font-smaller);';
            configTextarea = configDisplay.createEl('textarea', { attr: { rows: 8, placeholder: 'YAML configuration...' } });
            configTextarea.style.cssText = 'width: 100%; padding: 8px; border: 1px solid var(--background-modifier-border); border-radius: 4px; background: var(--background-primary); color: var(--text-normal); resize: vertical; font-family: var(--font-monospace); font-size: var(--font-smaller);';
            configTextarea.value = this.manager.generateYamlFromConfig(this.blockSettings.yamlConfig);
        }
        const promptContainer = container.createDiv({ cls: 'ollama-prompt-container' });
        promptContainer.style.cssText = 'position: relative; width: 100%; margin-bottom: 12px;';
        const promptInput = promptContainer.createEl('div', { cls: 'ollama-prompt-input', attr: { contenteditable: 'true', 'data-placeholder': 'Enter prompt...' } });
        promptInput.innerHTML = this.blockSettings.prompt;
        promptInput.style.cssText = 'width: 100%; padding: 12px; padding-bottom: 45px; border: 1px solid var(--background-modifier-border); border-radius: 8px; background: var(--background-primary); color: var(--text-normal); overflow: auto; min-height: 100px; white-space: pre-wrap; word-wrap: break-word; outline: none; transition: border-color 0.2s;';
        promptInput.addEventListener('focus', () => promptInput.style.borderColor = 'var(--interactive-accent)');
        promptInput.addEventListener('blur', () => promptInput.style.borderColor = 'var(--background-modifier-border)');
        const actionButtons = promptContainer.createDiv({ cls: 'ollama-action-buttons' });
        actionButtons.style.cssText = 'position: absolute; bottom: 10px; right: 10px; display: flex; gap: 8px; align-items: center;';
        const copyButton = actionButtons.createEl('button', { cls: 'ollama-copy-button' });
        setIcon(copyButton, 'copy');
        copyButton.style.cssText = 'width: 42px; height: 42px; border: none; border-radius: 50%; cursor: pointer; background: var(--background-modifier-border); opacity: 0.9; transition: all 0.2s; display: flex; align-items: center; justify-content: center; color: var(--text-normal);';
        copyButton.title = 'Copy prompt';
        const copyIcon = copyButton.querySelector('svg');
        if (copyIcon) {
            copyIcon.style.width = '28px';
            copyIcon.style.height = '28px';
        }
        copyButton.addEventListener('mouseenter', () => {
            copyButton.style.opacity = '1';
            copyButton.style.background = 'var(--background-modifier-border-hover)';
            copyButton.style.transform = 'scale(1.05)';
        });
        copyButton.addEventListener('mouseleave', () => {
            copyButton.style.opacity = '0.9';
            copyButton.style.background = 'var(--background-modifier-border)';
            copyButton.style.transform = 'scale(1)';
        });
        const saveButton = actionButtons.createEl('button', { cls: 'ollama-save-button' });
        setIcon(saveButton, 'save');
        saveButton.style.cssText = 'width: 42px; height: 42px; border: none; border-radius: 50%; cursor: pointer; background: var(--background-modifier-border); opacity: 0.9; transition: all 0.2s; display: flex; align-items: center; justify-content: center; color: var(--text-normal);';
        saveButton.title = 'Save prompt (Ctrl+S)';
        const saveIcon = saveButton.querySelector('svg');
        if (saveIcon) {
            saveIcon.style.width = '24px';
            saveIcon.style.height = '24px';
        }
        saveButton.addEventListener('mouseenter', () => {
            saveButton.style.opacity = '1';
            saveButton.style.background = 'var(--interactive-accent)';
            saveButton.style.color = 'var(--text-on-accent)';
            saveButton.style.transform = 'scale(1.05)';
        });
        saveButton.addEventListener('mouseleave', () => {
            saveButton.style.opacity = '0.9';
            saveButton.style.background = 'var(--background-modifier-border)';
            saveButton.style.color = 'var(--text-normal)';
            saveButton.style.transform = 'scale(1)';
        });
        const clearButton = actionButtons.createEl('button', { cls: 'ollama-clear-button' });
        setIcon(clearButton, 'trash');
        clearButton.style.cssText = 'width: 42px; height: 42px; border: none; border-radius: 50%; cursor: pointer; background: var(--background-modifier-border); opacity: 0.9; transition: all 0.2s; display: flex; align-items: center; justify-content: center; color: var(--text-normal);';
        clearButton.title = 'Clear prompt';
        const clearIcon = clearButton.querySelector('svg');
        if (clearIcon) {
            clearIcon.style.width = '28px';
            clearIcon.style.height = '28px';
        }
        clearButton.addEventListener('mouseenter', () => {
            clearButton.style.opacity = '1';
            clearButton.style.background = 'var(--text-error)';
            clearButton.style.color = 'white';
            clearButton.style.transform = 'scale(1.05)';
        });
        clearButton.addEventListener('mouseleave', () => {
            clearButton.style.opacity = '0.9';
            clearButton.style.background = 'var(--background-modifier-border)';
            clearButton.style.color = 'var(--text-normal)';
            clearButton.style.transform = 'scale(1)';
        });
        const submitButton = actionButtons.createEl('button', { cls: 'ollama-submit-button mod-cta' });
        setIcon(submitButton, 'send');
        submitButton.style.cssText = 'width: 42px; height: 42px; border: none; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; padding: 0;';
        submitButton.title = 'Generate (Enter)';
        const submitIcon = submitButton.querySelector('svg');
        if (submitIcon) {
            submitIcon.style.width = '20px';
            submitIcon.style.height = '20px';
        }
        const buttonContainer = container.createDiv({ cls: 'ollama-button-container' });
        buttonContainer.style.cssText = 'display: flex; gap: 10px; align-items: center; justify-content: flex-start;';
        const responsesContainer = buttonContainer.createDiv({ cls: 'ollama-responses-control' });
        responsesContainer.style.cssText = 'display: flex; align-items: center; gap: 8px; margin-left: auto;';
        responsesContainer.createEl('label', { text: 'Responses:', cls: 'setting-item-name' }).style.cssText = 'font-size: var(--font-smaller);';
        const initialResponses = this.blockSettings.yamlConfig.num_responses || 1;
        const responsesSlider = responsesContainer.createEl('input', { cls: 'ollama-responses-slider', attr: { type: 'range', min: '1', max: '20', value: initialResponses.toString(), step: '1' } });
        responsesSlider.style.cssText = 'width: 100px; cursor: pointer;';
        const responsesInput = responsesContainer.createEl('input', { cls: 'ollama-responses-input', attr: { type: 'number', min: '1', max: '20', value: initialResponses.toString() } });
        responsesInput.style.cssText = 'width: 50px; padding: 4px 8px; border: 1px solid var(--background-modifier-border); border-radius: 4px; background: var(--background-primary); color: var(--text-normal); font-size: var(--font-smaller);';
        const responsesWrapper = container.createDiv({ cls: 'ollama-responses-wrapper' });
        responsesWrapper.style.cssText = 'margin-top: 12px; display: none; flex-direction: column; gap: 8px;';
        this.components = { providerDropdown, modelDropdown, advancedButton, configDisplay, configTextarea, responsesSlider, responsesInput, promptInput, copyButton, clearButton, submitButton, saveButton, responsesWrapper };
    }
    initializeController() {
        const { providerDropdown, modelDropdown, advancedButton, configDisplay, configTextarea, responsesSlider, responsesInput, promptInput, copyButton, clearButton, submitButton, saveButton, responsesWrapper } = this.components;
        let abortController = null;
        let isGenerating = false;
        const updateSubmitButtonState = () => {
            const hasContent = promptInput.innerText.trim().length > 0;
            if (isGenerating) {
                submitButton.disabled = false;
                submitButton.style.opacity = '1';
                submitButton.style.backgroundColor = 'var(--text-error)';
                submitButton.style.color = 'white';
                setIcon(submitButton, 'square');
                const icon = submitButton.querySelector('svg');
                if (icon) {
                    icon.style.width = '14px';
                    icon.style.height = '14px';
                }
                submitButton.title = 'Stop generating';
            }
            else {
                submitButton.disabled = !hasContent;
                submitButton.style.opacity = hasContent ? '1' : '0.4';
                submitButton.style.backgroundColor = hasContent ? 'var(--interactive-accent)' : 'var(--background-modifier-border)';
                submitButton.style.color = hasContent ? 'var(--text-on-accent)' : 'var(--text-muted)';
                setIcon(submitButton, 'send');
                const icon = submitButton.querySelector('svg');
                if (icon) {
                    icon.style.width = '20px';
                    icon.style.height = '20px';
                }
                submitButton.title = hasContent ? 'Generate (Enter)' : 'Enter prompt to generate';
            }
        };
        updateSubmitButtonState();
        const populateModels = async () => {
            try {
                const providerId = providerDropdown.value;
                const provider = this.service.getProvider(providerId);
                const res = await provider.fetchModels();
                modelDropdown.innerHTML = '';
                res.models.forEach((m) => {
                    modelDropdown.createEl('option', { value: m.id, text: m.name });
                });
                const savedModel = this.blockSettings.yamlConfig.model;
                const defaultModel = providerId === 'ollama' ? this.service.getSettings().ollama.model : this.service.getSettings().openai.model;
                modelDropdown.value = savedModel || defaultModel;
            }
            catch (e) {
                new Notice('Failed to load models for selected provider');
            }
        };
        populateModels();
        providerDropdown.addEventListener('change', async () => {
            const providerId = providerDropdown.value;
            this.blockSettings.yamlConfig.provider = providerId;
            this.blockSettings.yamlConfig.model = ''; // Reset model on provider change
            const newYaml = this.manager.generateYamlFromConfig(this.blockSettings.yamlConfig);
            this.manager.updateFileBlock(this.el, this.ctx, promptInput.innerText.trim(), newYaml);
            if (configTextarea)
                configTextarea.value = newYaml;
            await populateModels();
        });
        modelDropdown.addEventListener('change', () => {
            this.blockSettings.yamlConfig.model = modelDropdown.value;
            const newYaml = this.manager.generateYamlFromConfig(this.blockSettings.yamlConfig);
            this.manager.updateFileBlock(this.el, this.ctx, promptInput.innerText.trim(), newYaml);
            if (configTextarea)
                configTextarea.value = newYaml;
        });
        if (copyButton) {
            copyButton.addEventListener('click', async () => {
                const text = promptInput.innerText.trim();
                if (text) {
                    await navigator.clipboard.writeText(text);
                    new Notice('Prompt copied to clipboard');
                }
            });
        }
        if (clearButton) {
            clearButton.addEventListener('click', () => {
                promptInput.innerText = '';
                updateSubmitButtonState();
                const yaml = this.blockSettings.hasYaml ? configTextarea.value : '';
                this.manager.updateFileBlock(this.el, this.ctx, '', yaml);
                new Notice('Prompt cleared');
            });
        }
        if (advancedButton) {
            advancedButton.addEventListener('click', () => {
                const isHidden = configDisplay.style.display === 'none';
                configDisplay.style.display = isHidden ? 'block' : 'none';
                advancedButton.style.background = isHidden ? 'var(--background-modifier-active-hover)' : 'transparent';
            });
            configTextarea.addEventListener('input', this.debounce(() => {
                this.manager.updateFileBlock(this.el, this.ctx, promptInput.innerText.trim(), configTextarea.value.trim());
            }, 1000));
        }
        const updateResponseCount = this.debounce((val) => {
            this.blockSettings.yamlConfig.num_responses = val;
            const newYaml = this.manager.generateYamlFromConfig(this.blockSettings.yamlConfig);
            this.manager.updateFileBlock(this.el, this.ctx, promptInput.innerText.trim(), newYaml);
            if (configTextarea)
                configTextarea.value = newYaml;
        }, 1000);
        responsesSlider.addEventListener('input', () => {
            responsesInput.value = responsesSlider.value;
            updateResponseCount(parseInt(responsesSlider.value));
        });
        responsesInput.addEventListener('input', () => {
            responsesSlider.value = responsesInput.value;
            updateResponseCount(parseInt(responsesInput.value));
        });
        const startGeneration = async () => {
            if (isGenerating) {
                abortController === null || abortController === void 0 ? void 0 : abortController.abort();
                return;
            }
            const prompt = promptInput.innerText.trim();
            if (!prompt)
                return;
            isGenerating = true;
            updateSubmitButtonState();
            const count = parseInt(responsesInput.value) || 1;
            responsesWrapper.style.display = 'flex';
            responsesWrapper.innerHTML = '';
            abortController = new AbortController();
            const providerId = providerDropdown.value;
            const provider = this.service.getProvider(providerId);
            try {
                for (let i = 0; i < count; i++) {
                    const item = responsesWrapper.createDiv({ cls: 'ollama-response-item' });
                    item.style.cssText = 'background: var(--background-primary); border: 1px solid var(--background-modifier-border); border-radius: 8px; padding: 12px; margin-bottom: 8px;';
                    const content = item.createDiv();
                    const outputPre = content.createEl('pre', { cls: 'ollama-output' });
                    outputPre.style.cssText = 'white-space: pre-wrap; font-size: var(--font-smaller); font-family: var(--font-monospace);';
                    try {
                        let statsShown = false;
                        const footerContainer = item.createDiv({ cls: 'ollama-response-footer' });
                        footerContainer.style.cssText = 'display: flex; justify-content: space-between; align-items: flex-end; margin-top: 8px; border-top: 1px solid var(--background-modifier-border); padding-top: 4px; position: relative;';
                        const copyRespButton = footerContainer.createEl('button', { cls: 'ollama-response-copy-button' });
                        setIcon(copyRespButton, 'copy');
                        copyRespButton.style.cssText = 'padding: 4px; border: none; border-radius: 4px; cursor: pointer; background: transparent; opacity: 0.3; transition: opacity 0.2s; display: flex; align-items: center; justify-content: center;';
                        copyRespButton.title = 'Copy response';
                        copyRespButton.addEventListener('mouseenter', () => copyRespButton.style.opacity = '1');
                        copyRespButton.addEventListener('mouseleave', () => copyRespButton.style.opacity = '0.3');
                        copyRespButton.addEventListener('click', async () => {
                            await navigator.clipboard.writeText(outputPre.textContent || '');
                            new Notice('Response copied');
                        });
                        const statsDiv = footerContainer.createDiv({ cls: 'ollama-stats' });
                        statsDiv.style.cssText = 'font-size: 10px; color: var(--text-muted);';
                        await provider.streamResponse(prompt, modelDropdown.value, this.blockSettings.yamlConfig, abortController, (chunk) => {
                            outputPre.textContent += chunk;
                        }, (final) => {
                            if (final.total_duration && !statsShown) {
                                statsShown = true;
                                const durationSec = (final.total_duration / 1e9).toFixed(2);
                                const totalTokens = (final.prompt_eval_count || 0) + (final.eval_count || 0);
                                statsDiv.textContent = `Tokens: ${totalTokens} | Time: ${durationSec}s`;
                            }
                        });
                    }
                    catch (e) {
                        if (e.name === 'AbortError')
                            break;
                        content.createDiv({ text: `Error: ${e.message}` }).style.color = 'var(--text-error)';
                        break;
                    }
                }
            }
            finally {
                isGenerating = false;
                updateSubmitButtonState();
            }
        };
        submitButton.addEventListener('click', startGeneration);
        const manualSave = async () => {
            const yaml = this.blockSettings.hasYaml ? configTextarea.value : '';
            await this.manager.updateFileBlock(this.el, this.ctx, promptInput.innerText.trim(), yaml);
            new Notice('Saved');
        };
        saveButton.addEventListener('click', manualSave);
        promptInput.addEventListener('input', () => {
            updateSubmitButtonState();
        });
        promptInput.addEventListener('blur', () => {
            const yaml = this.blockSettings.hasYaml ? configTextarea.value : '';
            this.manager.updateFileBlock(this.el, this.ctx, promptInput.innerText.trim(), yaml);
        });
        promptInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                startGeneration();
            }
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                manualSave();
            }
        });
        // Track focus/cursor position
        const trackFocus = () => {
            const section = this.ctx.getSectionInfo(this.el);
            if (!section)
                return;
            const selection = window.getSelection();
            if (!selection || selection.rangeCount === 0)
                return;
            const range = selection.getRangeAt(0);
            const preRange = range.cloneRange();
            preRange.selectNodeContents(promptInput);
            preRange.setEnd(range.startContainer, range.startOffset);
            const offset = preRange.toString().length;
            this.manager.sessionFocus = {
                lineStart: section.lineStart,
                ch: offset,
                file: this.ctx.sourcePath
            };
        };
        promptInput.addEventListener('keyup', trackFocus);
        promptInput.addEventListener('mouseup', trackFocus);
        promptInput.addEventListener('focus', trackFocus);
    }
    restoreFocus() {
        const { promptInput } = this.components;
        const section = this.ctx.getSectionInfo(this.el);
        const focus = this.manager.sessionFocus;
        if (section && focus.lineStart === section.lineStart && focus.file === this.ctx.sourcePath) {
            promptInput.focus();
            if (focus.ch !== null) {
                const selection = window.getSelection();
                const range = document.createRange();
                let currentOffset = 0;
                let targetNode = null;
                let targetOffset = 0;
                const findNode = (node) => {
                    if (node.nodeType === Node.TEXT_NODE) {
                        const len = node.length;
                        if (currentOffset + len >= focus.ch) {
                            targetNode = node;
                            targetOffset = focus.ch - currentOffset;
                            return true;
                        }
                        currentOffset += len;
                    }
                    else {
                        for (let i = 0; i < node.childNodes.length; i++) {
                            if (findNode(node.childNodes[i]))
                                return true;
                        }
                    }
                    return false;
                };
                findNode(promptInput);
                if (targetNode) {
                    range.setStart(targetNode, targetOffset);
                    range.collapse(true);
                    selection === null || selection === void 0 ? void 0 : selection.removeAllRanges();
                    selection === null || selection === void 0 ? void 0 : selection.addRange(range);
                }
                else {
                    // Fallback to end
                    range.selectNodeContents(promptInput);
                    range.collapse(false);
                    selection === null || selection === void 0 ? void 0 : selection.removeAllRanges();
                    selection === null || selection === void 0 ? void 0 : selection.addRange(range);
                }
            }
        }
    }
    debounce(fn, wait) {
        let t;
        return (...args) => {
            clearTimeout(t);
            t = setTimeout(() => fn.apply(this, args), wait);
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT2xsYW1hQmxvY2tWaWV3LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiT2xsYW1hQmxvY2tWaWV3LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQWdDLE9BQU8sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUt6RSxNQUFNLE9BQU8sZUFBZTtJQVN4QixZQUFZLEVBQWUsRUFBRSxPQUFtQixFQUFFLE9BQXFCLEVBQUUsR0FBaUMsRUFBRSxhQUErQjtRQUZuSSxlQUFVLEdBQVEsRUFBRSxDQUFDO1FBR3pCLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDO1FBQ2IsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7UUFDZixJQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztJQUN2QyxDQUFDO0lBRUQsTUFBTTtRQUNGLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDaEIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1FBQzVCLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN4QixDQUFDO0lBRU8sWUFBWTtRQUNoQixNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxrQkFBa0IsRUFBRSxDQUFDLENBQUM7UUFDakUsU0FBUyxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsNkZBQTZGLENBQUM7UUFFeEgsTUFBTSxTQUFTLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxlQUFlLEVBQUUsQ0FBQyxDQUFDO1FBQ2hFLFNBQVMsQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLDBGQUEwRixDQUFDO1FBQ3JILFNBQVMsQ0FB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QUFDLENBQUM7UUFDckQsQ0FBQyxDQUFDO0lBQ04sQ0FBQztDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTm90aWNlLCBNYXJrZG93blBvc3RQcm9jZXNzb3JDb250ZXh0LCBzZXRJY29uIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgTExNQmxvY2tTZXR0aW5ncywgUHJvdmlkZXJUeXBlLCBMTE1Nb2RlbCB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IExMTVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9MTE1TZXJ2aWNlJztcbmltcG9ydCB7IEJsb2NrTWFuYWdlciB9IGZyb20gJy4uL2xvZ2ljL0Jsb2NrTWFuYWdlcic7XG5cbmV4cG9ydCBjbGFzcyBPbGxhbWFCbG9ja1ZpZXcge1xuICAgIHByaXZhdGUgZWw6IEhUTUxFbGVtZW50O1xuICAgIHByaXZhdGUgc2VydmljZTogTExNU2VydmljZTtcbiAgICBwcml2YXRlIG1hbmFnZXI6IEJsb2NrTWFuYWdlcjtcbiAgICBwcml2YXRlIGN0eDogTWFya2Rvd25Qb3N0UHJvY2Vzc29yQ29udGV4dDtcbiAgICBwcml2YXRlIGJsb2NrU2V0dGluZ3M6IExMTUJsb2NrU2V0dGluZ3M7XG5cbiAgICBwcml2YXRlIGNvbXBvbmVudHM6IGFueSA9IHt9O1xuXG4gICAgY29uc3RydWN0b3IoZWw6IEhUTUxFbGVtZW50LCBzZXJ2aWNlOiBMTE1TZXJ2aWNlLCBtYW5hZ2VyOiBCbG9ja01hbmFnZXIsIGN0eDogTWFya2Rvd25Qb3N0UHJvY2Vzc29yQ29udGV4dCwgYmxvY2tTZXR0aW5nczogTExNQmxvY2tTZXR0aW5ncykge1xuICAgICAgICB0aGlzLmVsID0gZWw7XG4gICAgICAgIHRoaXMuc2VydmljZSA9IHNlcnZpY2U7XG4gICAgICAgIHRoaXMubWFuYWdlciA9IG1hbmFnZXI7XG4gICAgICAgIHRoaXMuY3R4ID0gY3R4O1xuICAgICAgICB0aGlzLmJsb2NrU2V0dGluZ3MgPSBibG9ja1NldHRpbmdzO1xuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdGhpcy5lbC5lbXB0eSgpO1xuICAgICAgICB0aGlzLmNyZWF0ZUxheW91dCgpO1xuICAgICAgICB0aGlzLmluaXRpYWxpemVDb250cm9sbGVyKCk7XG4gICAgICAgIHRoaXMucmVzdG9yZUZvY3VzKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjcmVhdGVMYXlvdXQoKSB7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuZWwuY3JlYXRlRGl2KHsgY2xzOiAnb2xsYW1hLWNvbnRhaW5lcicgfSk7XG4gICAgICAgIGNvbnRhaW5lci5zdHlsZS5jc3NUZXh0ID0gJ3BhZGRpbmc6IDEycHg7IGJhY2tncm91bmQ6IHZhcigtLWJhY2tncm91bmQtc2Vjb25kYXJ5KTsgYm9yZGVyLXJhZGl1czogOHB4OyBtYXJnaW46IDEwcHggMDsnO1xuXG4gICAgICAgIGNvbnN0IGhlYWRlclJvdyA9IGNvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6ICdvbGxhbWEtaGVhZGVyJyB9KTtcbiAgICAgICAgaGVhZGVyUm93LnN0eWxlLmNzc1RleHQgPSAnZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBtYXJnaW4tYm90dG9tOiAxMnB4Oyc7XG4gICAgICAgIGhlYWRlclJvdy5jcmVhdGVFbCgnbGFiZWwnLCB7IHRleHQ6ICdQcm9tcHQ6JywgY2xzOiAnc2V0dGluZy1pdGVtLW5hbWUnIH0pLnN0eWxlLmNzc1RleHQgPSAnZm9udC13ZWlnaHQ6IDYwMDsgbWFyZ2luLXJpZ2h0OiAxNnB4Oyc7XG5cbiAgICAgICAgY29uc3QgY29udHJvbHNSb3cgPSBoZWFkZXJSb3cuY3JlYXRlRGl2KHsgY2xzOiAnb2xsYW1hLWNvbnRyb2xzJyB9KTtcbiAgICAgICAgY29udHJvbHNSb3cuc3R5bGUuY3NzVGV4dCA9ICdkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDhweDsnO1xuXG4gICAgICAgIC8vIFByb3ZpZGVyIFNlbGVjdGlvblxuICAgICAgICBjb25zdCBwcm92aWRlckRyb3Bkb3duID0gY29udHJvbHNSb3cuY3JlYXRlRWwoJ3NlbGVjdCcsIHsgY2xzOiAnb2xsYW1hLXByb3ZpZGVyLWRyb3Bkb3duIGRyb3Bkb3duJyB9KTtcbiAgICAgICAgcHJvdmlkZXJEcm9wZG93bi5zdHlsZS5jc3NUZXh0ID0gJ3BhZGRpbmc6IDRweCAxMnB4OyBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcik7IGJvcmRlci1yYWRpdXM6IDRweDsgYmFja2dyb3VuZDogdmFyKC0tYmFja2dyb3VuZC1wcmltYXJ5KTsgY29sb3I6IHZhcigtLXRleHQtbm9ybWFsKTsgZm9udC1zaXplOiB2YXIoLS1mb250LXNtYWxsZXIpOyBjdXJzb3I6IHBvaW50ZXI7JztcblxuICAgICAgICBjb25zdCBwcm92aWRlcnMgPSB0aGlzLnNlcnZpY2UuZ2V0RW5hYmxlZFByb3ZpZGVycygpO1xuICAgICAgICBwcm92aWRlcnMuZm9yRWFjaChwID0+IHtcbiAgICAgICAgICAgIHByb3ZpZGVyRHJvcGRvd24uY3JlYXRlRWwoJ29wdGlvbicsIHsgdmFsdWU6IHAuaWQsIHRleHQ6IHAubmFtZSB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHByb3ZpZGVyRHJvcGRvd24udmFsdWUgPSB0aGlzLmJsb2NrU2V0dGluZ3MueWFtbENvbmZpZy5wcm92aWRlciB8fCB0aGlzLnNlcnZpY2UuZ2V0U2V0dGluZ3MoKS5hY3RpdmVQcm92aWRlcjtcblxuICAgICAgICAvLyBNb2RlbCBTZWxlY3Rpb25cbiAgICAgICAgY29uc3QgbW9kZWxMYWJlbCA9IGNvbnRyb2xzUm93LmNyZWF0ZUVsKCdsYWJlbCcsIHsgdGV4dDogJ01vZGVsOicsIGNsczogJ3NldHRpbmctaXRlbS1uYW1lJyB9KTtcbiAgICAgICAgbW9kZWxMYWJlbC5zdHlsZS5jc3NUZXh0ID0gJ2ZvbnQtc2l6ZTogdmFyKC0tZm9udC1zbWFsbGVyKTsgZm9udC13ZWlnaHQ6IDUwMDsgZm9udC1mYW1pbHk6IHZhcigtLWZvbnQtaW50ZXJmYWNlKTsgbWFyZ2luLWxlZnQ6IDhweDsnO1xuXG4gICAgICAgIGNvbnN0IG1vZGVsRHJvcGRvd24gPSBjb250cm9sc1Jvdy5jcmVhdGVFbCgnc2VsZWN0JywgeyBjbHM6ICdvbGxhbWEtbW9kZWwtZHJvcGRvd24gZHJvcGRvd24nIH0pO1xuICAgICAgICBtb2RlbERyb3Bkb3duLnN0eWxlLmNzc1RleHQgPSAncGFkZGluZzogNHB4IDMycHggNHB4IDEycHg7IGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyKTsgYm9yZGVyLXJhZGl1czogNHB4OyBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLXByaW1hcnkpOyBjb2xvcjogdmFyKC0tdGV4dC1ub3JtYWwpOyBmb250LXNpemU6IHZhcigtLWZvbnQtc21hbGxlcik7IGxpbmUtaGVpZ2h0OiAxLjU7IGN1cnNvcjogcG9pbnRlcjsgbWluLXdpZHRoOiAxNDBweDsgd2lkdGg6IGZpdC1jb250ZW50OyBtYXgtd2lkdGg6IDMwMHB4OyBoZWlnaHQ6IGF1dG87JztcblxuICAgICAgICBsZXQgYWR2YW5jZWRCdXR0b246IEhUTUxCdXR0b25FbGVtZW50IHwgbnVsbCA9IG51bGw7XG4gICAgICAgIGxldCBjb25maWdUZXh0YXJlYTogSFRNTFRleHRBcmVhRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICAgICAgICBsZXQgY29uZmlnRGlzcGxheTogSFRNTERpdkVsZW1lbnQgfCBudWxsID0gbnVsbDtcblxuICAgICAgICBpZiAodGhpcy5ibG9ja1NldHRpbmdzLmhhc1lhbWwpIHtcbiAgICAgICAgICAgIGFkdmFuY2VkQnV0dG9uID0gY29udHJvbHNSb3cuY3JlYXRlRWwoJ2J1dHRvbicsIHsgY2xzOiAnb2xsYW1hLWFkdmFuY2VkLWJ1dHRvbicgfSk7XG4gICAgICAgICAgICBzZXRJY29uKGFkdmFuY2VkQnV0dG9uLCAnc2V0dGluZ3MnKTtcbiAgICAgICAgICAgIGFkdmFuY2VkQnV0dG9uLnN0eWxlLmNzc1RleHQgPSAncGFkZGluZzogNHB4OyBib3JkZXI6IG5vbmU7IGJvcmRlci1yYWRpdXM6IDRweDsgY3Vyc29yOiBwb2ludGVyOyBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7IG1hcmdpbi1sZWZ0OiA0cHg7JztcbiAgICAgICAgICAgIGFkdmFuY2VkQnV0dG9uLnRpdGxlID0gJ0FkdmFuY2VkIFNldHRpbmdzJztcblxuICAgICAgICAgICAgY29uZmlnRGlzcGxheSA9IGNvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6ICdvbGxhbWEtY29uZmlnLWRpc3BsYXknIH0pO1xuICAgICAgICAgICAgY29uZmlnRGlzcGxheS5zdHlsZS5jc3NUZXh0ID0gJ2Rpc3BsYXk6IG5vbmU7IGJhY2tncm91bmQ6IHZhcigtLWJhY2tncm91bmQtcHJpbWFyeSk7IGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyKTsgYm9yZGVyLXJhZGl1czogNHB4OyBwYWRkaW5nOiAxMnB4OyBtYXJnaW4tYm90dG9tOiAxMnB4OyBmb250LXNpemU6IHZhcigtLWZvbnQtc21hbGxlcik7JztcblxuICAgICAgICAgICAgY29uZmlnVGV4dGFyZWEgPSBjb25maWdEaXNwbGF5LmNyZWF0ZUVsKCd0ZXh0YXJlYScsIHsgYXR0cjogeyByb3dzOiA4LCBwbGFjZWhvbGRlcjogJ1lBTUwgY29uZmlndXJhdGlvbi4uLicgfSB9KTtcbiAgICAgICAgICAgIGNvbmZpZ1RleHRhcmVhLnN0eWxlLmNzc1RleHQgPSAnd2lkdGg6IDEwMCU7IHBhZGRpbmc6IDhweDsgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpOyBib3JkZXItcmFkaXVzOiA0cHg7IGJhY2tncm91bmQ6IHZhcigtLWJhY2tncm91bmQtcHJpbWFyeSk7IGNvbG9yOiB2YXIoLS10ZXh0LW5vcm1hbCk7IHJlc2l6ZTogdmVydGljYWw7IGZvbnQtZmFtaWx5OiB2YXIoLS1mb250LW1vbm9zcGFjZSk7IGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zbWFsbGVyKTsnO1xuICAgICAgICAgICAgY29uZmlnVGV4dGFyZWEudmFsdWUgPSB0aGlzLm1hbmFnZXIuZ2VuZXJhdGVZYW1sRnJvbUNvbmZpZyh0aGlzLmJsb2NrU2V0dGluZ3MueWFtbENvbmZpZyk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwcm9tcHRDb250YWluZXIgPSBjb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiAnb2xsYW1hLXByb21wdC1jb250YWluZXInIH0pO1xuICAgICAgICBwcm9tcHRDb250YWluZXIuc3R5bGUuY3NzVGV4dCA9ICdwb3NpdGlvbjogcmVsYXRpdmU7IHdpZHRoOiAxMDAlOyBtYXJnaW4tYm90dG9tOiAxMnB4Oyc7XG5cbiAgICAgICAgY29uc3QgcHJvbXB0SW5wdXQgPSBwcm9tcHRDb250YWluZXIuY3JlYXRlRWwoJ2RpdicsIHsgY2xzOiAnb2xsYW1hLXByb21wdC1pbnB1dCcsIGF0dHI6IHsgY29udGVudGVkaXRhYmxlOiAndHJ1ZScsICdkYXRhLXBsYWNlaG9sZGVyJzogJ0VudGVyIHByb21wdC4uLicgfSB9KTtcbiAgICAgICAgcHJvbXB0SW5wdXQuaW5uZXJIVE1MID0gdGhpcy5ibG9ja1NldHRpbmdzLnByb21wdDtcbiAgICAgICAgcHJvbXB0SW5wdXQuc3R5bGUuY3NzVGV4dCA9ICd3aWR0aDogMTAwJTsgcGFkZGluZzogMTJweDsgcGFkZGluZy1ib3R0b206IDQ1cHg7IGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyKTsgYm9yZGVyLXJhZGl1czogOHB4OyBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLXByaW1hcnkpOyBjb2xvcjogdmFyKC0tdGV4dC1ub3JtYWwpOyBvdmVyZmxvdzogYXV0bzsgbWluLWhlaWdodDogMTAwcHg7IHdoaXRlLXNwYWNlOiBwcmUtd3JhcDsgd29yZC13cmFwOiBicmVhay13b3JkOyBvdXRsaW5lOiBub25lOyB0cmFuc2l0aW9uOiBib3JkZXItY29sb3IgMC4yczsnO1xuICAgICAgICBwcm9tcHRJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsICgpID0+IHByb21wdElucHV0LnN0eWxlLmJvcmRlckNvbG9yID0gJ3ZhcigtLWludGVyYWN0aXZlLWFjY2VudCknKTtcbiAgICAgICAgcHJvbXB0SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsICgpID0+IHByb21wdElucHV0LnN0eWxlLmJvcmRlckNvbG9yID0gJ3ZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyKScpO1xuXG4gICAgICAgIGNvbnN0IGFjdGlvbkJ1dHRvbnMgPSBwcm9tcHRDb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiAnb2xsYW1hLWFjdGlvbi1idXR0b25zJyB9KTtcbiAgICAgICAgYWN0aW9uQnV0dG9ucy5zdHlsZS5jc3NUZXh0ID0gJ3Bvc2l0aW9uOiBhYnNvbHV0ZTsgYm90dG9tOiAxMHB4OyByaWdodDogMTBweDsgZGlzcGxheTogZmxleDsgZ2FwOiA4cHg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7JztcblxuICAgICAgICBjb25zdCBjb3B5QnV0dG9uID0gYWN0aW9uQnV0dG9ucy5jcmVhdGVFbCgnYnV0dG9uJywgeyBjbHM6ICdvbGxhbWEtY29weS1idXR0b24nIH0pO1xuICAgICAgICBzZXRJY29uKGNvcHlCdXR0b24sICdjb3B5Jyk7XG4gICAgICAgIGNvcHlCdXR0b24uc3R5bGUuY3NzVGV4dCA9ICd3aWR0aDogNDJweDsgaGVpZ2h0OiA0MnB4OyBib3JkZXI6IG5vbmU7IGJvcmRlci1yYWRpdXM6IDUwJTsgY3Vyc29yOiBwb2ludGVyOyBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcik7IG9wYWNpdHk6IDAuOTsgdHJhbnNpdGlvbjogYWxsIDAuMnM7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBjb2xvcjogdmFyKC0tdGV4dC1ub3JtYWwpOyc7XG4gICAgICAgIGNvcHlCdXR0b24udGl0bGUgPSAnQ29weSBwcm9tcHQnO1xuICAgICAgICBjb25zdCBjb3B5SWNvbiA9IGNvcHlCdXR0b24ucXVlcnlTZWxlY3Rvcignc3ZnJyk7XG4gICAgICAgIGlmIChjb3B5SWNvbikgeyBjb3B5SWNvbi5zdHlsZS53aWR0aCA9ICcyOHB4JzsgY29weUljb24uc3R5bGUuaGVpZ2h0ID0gJzI4cHgnOyB9XG5cbiAgICAgICAgY29weUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgKCkgPT4ge1xuICAgICAgICAgICAgY29weUJ1dHRvbi5zdHlsZS5vcGFjaXR5ID0gJzEnO1xuICAgICAgICAgICAgY29weUJ1dHRvbi5zdHlsZS5iYWNrZ3JvdW5kID0gJ3ZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyLWhvdmVyKSc7XG4gICAgICAgICAgICBjb3B5QnV0dG9uLnN0eWxlLnRyYW5zZm9ybSA9ICdzY2FsZSgxLjA1KSc7XG4gICAgICAgIH0pO1xuICAgICAgICBjb3B5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb3B5QnV0dG9uLnN0eWxlLm9wYWNpdHkgPSAnMC45JztcbiAgICAgICAgICAgIGNvcHlCdXR0b24uc3R5bGUuYmFja2dyb3VuZCA9ICd2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlciknO1xuICAgICAgICAgICAgY29weUJ1dHRvbi5zdHlsZS50cmFuc2Zvcm0gPSAnc2NhbGUoMSknO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBzYXZlQnV0dG9uID0gYWN0aW9uQnV0dG9ucy5jcmVhdGVFbCgnYnV0dG9uJywgeyBjbHM6ICdvbGxhbWEtc2F2ZS1idXR0b24nIH0pO1xuICAgICAgICBzZXRJY29uKHNhdmVCdXR0b24sICdzYXZlJyk7XG4gICAgICAgIHNhdmVCdXR0b24uc3R5bGUuY3NzVGV4dCA9ICd3aWR0aDogNDJweDsgaGVpZ2h0OiA0MnB4OyBib3JkZXI6IG5vbmU7IGJvcmRlci1yYWRpdXM6IDUwJTsgY3Vyc29yOiBwb2ludGVyOyBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcik7IG9wYWNpdHk6IDAuOTsgdHJhbnNpdGlvbjogYWxsIDAuMnM7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBjb2xvcjogdmFyKC0tdGV4dC1ub3JtYWwpOyc7XG4gICAgICAgIHNhdmVCdXR0b24udGl0bGUgPSAnU2F2ZSBwcm9tcHQgKEN0cmwrUyknO1xuICAgICAgICBjb25zdCBzYXZlSWNvbiA9IHNhdmVCdXR0b24ucXVlcnlTZWxlY3Rvcignc3ZnJyk7XG4gICAgICAgIGlmIChzYXZlSWNvbikgeyBzYXZlSWNvbi5zdHlsZS53aWR0aCA9ICcyNHB4Jzsgc2F2ZUljb24uc3R5bGUuaGVpZ2h0ID0gJzI0cHgnOyB9XG5cbiAgICAgICAgc2F2ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgKCkgPT4ge1xuICAgICAgICAgICAgc2F2ZUJ1dHRvbi5zdHlsZS5vcGFjaXR5ID0gJzEnO1xuICAgICAgICAgICAgc2F2ZUJ1dHRvbi5zdHlsZS5iYWNrZ3JvdW5kID0gJ3ZhcigtLWludGVyYWN0aXZlLWFjY2VudCknO1xuICAgICAgICAgICAgc2F2ZUJ1dHRvbi5zdHlsZS5jb2xvciA9ICd2YXIoLS10ZXh0LW9uLWFjY2VudCknO1xuICAgICAgICAgICAgc2F2ZUJ1dHRvbi5zdHlsZS50cmFuc2Zvcm0gPSAnc2NhbGUoMS4wNSknO1xuICAgICAgICB9KTtcbiAgICAgICAgc2F2ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgKCkgPT4ge1xuICAgICAgICAgICAgc2F2ZUJ1dHRvbi5zdHlsZS5vcGFjaXR5ID0gJzAuOSc7XG4gICAgICAgICAgICBzYXZlQnV0dG9uLnN0eWxlLmJhY2tncm91bmQgPSAndmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpJztcbiAgICAgICAgICAgIHNhdmVCdXR0b24uc3R5bGUuY29sb3IgPSAndmFyKC0tdGV4dC1ub3JtYWwpJztcbiAgICAgICAgICAgIHNhdmVCdXR0b24uc3R5bGUudHJhbnNmb3JtID0gJ3NjYWxlKDEpJztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgY2xlYXJCdXR0b24gPSBhY3Rpb25CdXR0b25zLmNyZWF0ZUVsKCdidXR0b24nLCB7IGNsczogJ29sbGFtYS1jbGVhci1idXR0b24nIH0pO1xuICAgICAgICBzZXRJY29uKGNsZWFyQnV0dG9uLCAndHJhc2gnKTtcbiAgICAgICAgY2xlYXJCdXR0b24uc3R5bGUuY3NzVGV4dCA9ICd3aWR0aDogNDJweDsgaGVpZ2h0OiA0MnB4OyBib3JkZXI6IG5vbmU7IGJvcmRlci1yYWRpdXM6IDUwJTsgY3Vyc29yOiBwb2ludGVyOyBiYWNrZ3JvdW5kOiB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcik7IG9wYWNpdHk6IDAuOTsgdHJhbnNpdGlvbjogYWxsIDAuMnM7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBjb2xvcjogdmFyKC0tdGV4dC1ub3JtYWwpOyc7XG4gICAgICAgIGNsZWFyQnV0dG9uLnRpdGxlID0gJ0NsZWFyIHByb21wdCc7XG4gICAgICAgIGNvbnN0IGNsZWFySWNvbiA9IGNsZWFyQnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJ3N2ZycpO1xuICAgICAgICBpZiAoY2xlYXJJY29uKSB7IGNsZWFySWNvbi5zdHlsZS53aWR0aCA9ICcyOHB4JzsgY2xlYXJJY29uLnN0eWxlLmhlaWdodCA9ICcyOHB4JzsgfVxuXG4gICAgICAgIGNsZWFyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCAoKSA9PiB7XG4gICAgICAgICAgICBjbGVhckJ1dHRvbi5zdHlsZS5vcGFjaXR5ID0gJzEnO1xuICAgICAgICAgICAgY2xlYXJCdXR0b24uc3R5bGUuYmFja2dyb3VuZCA9ICd2YXIoLS10ZXh0LWVycm9yKSc7XG4gICAgICAgICAgICBjbGVhckJ1dHRvbi5zdHlsZS5jb2xvciA9ICd3aGl0ZSc7XG4gICAgICAgICAgICBjbGVhckJ1dHRvbi5zdHlsZS50cmFuc2Zvcm0gPSAnc2NhbGUoMS4wNSknO1xuICAgICAgICB9KTtcbiAgICAgICAgY2xlYXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsICgpID0+IHtcbiAgICAgICAgICAgIGNsZWFyQnV0dG9uLnN0eWxlLm9wYWNpdHkgPSAnMC45JztcbiAgICAgICAgICAgIGNsZWFyQnV0dG9uLnN0eWxlLmJhY2tncm91bmQgPSAndmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpJztcbiAgICAgICAgICAgIGNsZWFyQnV0dG9uLnN0eWxlLmNvbG9yID0gJ3ZhcigtLXRleHQtbm9ybWFsKSc7XG4gICAgICAgICAgICBjbGVhckJ1dHRvbi5zdHlsZS50cmFuc2Zvcm0gPSAnc2NhbGUoMSknO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBzdWJtaXRCdXR0b24gPSBhY3Rpb25CdXR0b25zLmNyZWF0ZUVsKCdidXR0b24nLCB7IGNsczogJ29sbGFtYS1zdWJtaXQtYnV0dG9uIG1vZC1jdGEnIH0pO1xuICAgICAgICBzZXRJY29uKHN1Ym1pdEJ1dHRvbiwgJ3NlbmQnKTtcbiAgICAgICAgc3VibWl0QnV0dG9uLnN0eWxlLmNzc1RleHQgPSAnd2lkdGg6IDQycHg7IGhlaWdodDogNDJweDsgYm9yZGVyOiBub25lOyBib3JkZXItcmFkaXVzOiA1MCU7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBjdXJzb3I6IHBvaW50ZXI7IHRyYW5zaXRpb246IGFsbCAwLjJzOyBwYWRkaW5nOiAwOyc7XG4gICAgICAgIHN1Ym1pdEJ1dHRvbi50aXRsZSA9ICdHZW5lcmF0ZSAoRW50ZXIpJztcbiAgICAgICAgY29uc3Qgc3VibWl0SWNvbiA9IHN1Ym1pdEJ1dHRvbi5xdWVyeVNlbGVjdG9yKCdzdmcnKTtcbiAgICAgICAgaWYgKHN1Ym1pdEljb24pIHsgc3VibWl0SWNvbi5zdHlsZS53aWR0aCA9ICcyMHB4Jzsgc3VibWl0SWNvbi5zdHlsZS5oZWlnaHQgPSAnMjBweCc7IH1cblxuICAgICAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBjb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiAnb2xsYW1hLWJ1dHRvbi1jb250YWluZXInIH0pO1xuICAgICAgICBidXR0b25Db250YWluZXIuc3R5bGUuY3NzVGV4dCA9ICdkaXNwbGF5OiBmbGV4OyBnYXA6IDEwcHg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogZmxleC1zdGFydDsnO1xuXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlc0NvbnRhaW5lciA9IGJ1dHRvbkNvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6ICdvbGxhbWEtcmVzcG9uc2VzLWNvbnRyb2wnIH0pO1xuICAgICAgICByZXNwb25zZXNDb250YWluZXIuc3R5bGUuY3NzVGV4dCA9ICdkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDhweDsgbWFyZ2luLWxlZnQ6IGF1dG87JztcbiAgICAgICAgcmVzcG9uc2VzQ29udGFpbmVyLmNyZWF0ZUVsKCdsYWJlbCcsIHsgdGV4dDogJ1Jlc3BvbnNlczonLCBjbHM6ICdzZXR0aW5nLWl0ZW0tbmFtZScgfSkuc3R5bGUuY3NzVGV4dCA9ICdmb250LXNpemU6IHZhcigtLWZvbnQtc21hbGxlcik7JztcblxuICAgICAgICBjb25zdCBpbml0aWFsUmVzcG9uc2VzID0gdGhpcy5ibG9ja1NldHRpbmdzLnlhbWxDb25maWcubnVtX3Jlc3BvbnNlcyB8fCAxO1xuICAgICAgICBjb25zdCByZXNwb25zZXNTbGlkZXIgPSByZXNwb25zZXNDb250YWluZXIuY3JlYXRlRWwoJ2lucHV0JywgeyBjbHM6ICdvbGxhbWEtcmVzcG9uc2VzLXNsaWRlcicsIGF0dHI6IHsgdHlwZTogJ3JhbmdlJywgbWluOiAnMScsIG1heDogJzIwJywgdmFsdWU6IGluaXRpYWxSZXNwb25zZXMudG9TdHJpbmcoKSwgc3RlcDogJzEnIH0gfSk7XG4gICAgICAgIHJlc3BvbnNlc1NsaWRlci5zdHlsZS5jc3NUZXh0ID0gJ3dpZHRoOiAxMDBweDsgY3Vyc29yOiBwb2ludGVyOyc7XG5cbiAgICAgICAgY29uc3QgcmVzcG9uc2VzSW5wdXQgPSByZXNwb25zZXNDb250YWluZXIuY3JlYXRlRWwoJ2lucHV0JywgeyBjbHM6ICdvbGxhbWEtcmVzcG9uc2VzLWlucHV0JywgYXR0cjogeyB0eXBlOiAnbnVtYmVyJywgbWluOiAnMScsIG1heDogJzIwJywgdmFsdWU6IGluaXRpYWxSZXNwb25zZXMudG9TdHJpbmcoKSB9IH0pO1xuICAgICAgICByZXNwb25zZXNJbnB1dC5zdHlsZS5jc3NUZXh0ID0gJ3dpZHRoOiA1MHB4OyBwYWRkaW5nOiA0cHggOHB4OyBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcik7IGJvcmRlci1yYWRpdXM6IDRweDsgYmFja2dyb3VuZDogdmFyKC0tYmFja2dyb3VuZC1wcmltYXJ5KTsgY29sb3I6IHZhcigtLXRleHQtbm9ybWFsKTsgZm9udC1zaXplOiB2YXIoLS1mb250LXNtYWxsZXIpOyc7XG5cbiAgICAgICAgY29uc3QgcmVzcG9uc2VzV3JhcHBlciA9IGNvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6ICdvbGxhbWEtcmVzcG9uc2VzLXdyYXBwZXInIH0pO1xuICAgICAgICByZXNwb25zZXNXcmFwcGVyLnN0eWxlLmNzc1RleHQgPSAnbWFyZ2luLXRvcDogMTJweDsgZGlzcGxheTogbm9uZTsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsgZ2FwOiA4cHg7JztcblxuICAgICAgICB0aGlzLmNvbXBvbmVudHMgPSB7IHByb3ZpZGVyRHJvcGRvd24sIG1vZGVsRHJvcGRvd24sIGFkdmFuY2VkQnV0dG9uLCBjb25maWdEaXNwbGF5LCBjb25maWdUZXh0YXJlYSwgcmVzcG9uc2VzU2xpZGVyLCByZXNwb25zZXNJbnB1dCwgcHJvbXB0SW5wdXQsIGNvcHlCdXR0b24sIGNsZWFyQnV0dG9uLCBzdWJtaXRCdXR0b24sIHNhdmVCdXR0b24sIHJlc3BvbnNlc1dyYXBwZXIgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGluaXRpYWxpemVDb250cm9sbGVyKCkge1xuICAgICAgICBjb25zdCB7IHByb3ZpZGVyRHJvcGRvd24sIG1vZGVsRHJvcGRvd24sIGFkdmFuY2VkQnV0dG9uLCBjb25maWdEaXNwbGF5LCBjb25maWdUZXh0YXJlYSwgcmVzcG9uc2VzU2xpZGVyLCByZXNwb25zZXNJbnB1dCwgcHJvbXB0SW5wdXQsIGNvcHlCdXR0b24sIGNsZWFyQnV0dG9uLCBzdWJtaXRCdXR0b24sIHNhdmVCdXR0b24sIHJlc3BvbnNlc1dyYXBwZXIgfSA9IHRoaXMuY29tcG9uZW50cztcbiAgICAgICAgbGV0IGFib3J0Q29udHJvbGxlcjogQWJvcnRDb250cm9sbGVyIHwgbnVsbCA9IG51bGw7XG4gICAgICAgIGxldCBpc0dlbmVyYXRpbmcgPSBmYWxzZTtcblxuICAgICAgICBjb25zdCB1cGRhdGVTdWJtaXRCdXR0b25TdGF0ZSA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGhhc0NvbnRlbnQgPSBwcm9tcHRJbnB1dC5pbm5lclRleHQudHJpbSgpLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICBpZiAoaXNHZW5lcmF0aW5nKSB7XG4gICAgICAgICAgICAgICAgc3VibWl0QnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgc3VibWl0QnV0dG9uLnN0eWxlLm9wYWNpdHkgPSAnMSc7XG4gICAgICAgICAgICAgICAgc3VibWl0QnV0dG9uLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICd2YXIoLS10ZXh0LWVycm9yKSc7XG4gICAgICAgICAgICAgICAgc3VibWl0QnV0dG9uLnN0eWxlLmNvbG9yID0gJ3doaXRlJztcbiAgICAgICAgICAgICAgICBzZXRJY29uKHN1Ym1pdEJ1dHRvbiwgJ3NxdWFyZScpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGljb24gPSBzdWJtaXRCdXR0b24ucXVlcnlTZWxlY3Rvcignc3ZnJyk7XG4gICAgICAgICAgICAgICAgaWYgKGljb24pIHsgaWNvbi5zdHlsZS53aWR0aCA9ICcxNHB4JzsgaWNvbi5zdHlsZS5oZWlnaHQgPSAnMTRweCc7IH1cbiAgICAgICAgICAgICAgICBzdWJtaXRCdXR0b24udGl0bGUgPSAnU3RvcCBnZW5lcmF0aW5nJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc3VibWl0QnV0dG9uLmRpc2FibGVkID0gIWhhc0NvbnRlbnQ7XG4gICAgICAgICAgICAgICAgc3VibWl0QnV0dG9uLnN0eWxlLm9wYWNpdHkgPSBoYXNDb250ZW50ID8gJzEnIDogJzAuNCc7XG4gICAgICAgICAgICAgICAgc3VibWl0QnV0dG9uLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGhhc0NvbnRlbnQgPyAndmFyKC0taW50ZXJhY3RpdmUtYWNjZW50KScgOiAndmFyKC0tYmFja2dyb3VuZC1tb2RpZmllci1ib3JkZXIpJztcbiAgICAgICAgICAgICAgICBzdWJtaXRCdXR0b24uc3R5bGUuY29sb3IgPSBoYXNDb250ZW50ID8gJ3ZhcigtLXRleHQtb24tYWNjZW50KScgOiAndmFyKC0tdGV4dC1tdXRlZCknO1xuICAgICAgICAgICAgICAgIHNldEljb24oc3VibWl0QnV0dG9uLCAnc2VuZCcpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGljb24gPSBzdWJtaXRCdXR0b24ucXVlcnlTZWxlY3Rvcignc3ZnJyk7XG4gICAgICAgICAgICAgICAgaWYgKGljb24pIHsgaWNvbi5zdHlsZS53aWR0aCA9ICcyMHB4JzsgaWNvbi5zdHlsZS5oZWlnaHQgPSAnMjBweCc7IH1cbiAgICAgICAgICAgICAgICBzdWJtaXRCdXR0b24udGl0bGUgPSBoYXNDb250ZW50ID8gJ0dlbmVyYXRlIChFbnRlciknIDogJ0VudGVyIHByb21wdCB0byBnZW5lcmF0ZSc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdXBkYXRlU3VibWl0QnV0dG9uU3RhdGUoKTtcblxuICAgICAgICBjb25zdCBwb3B1bGF0ZU1vZGVscyA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvdmlkZXJJZCA9IHByb3ZpZGVyRHJvcGRvd24udmFsdWU7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvdmlkZXIgPSB0aGlzLnNlcnZpY2UuZ2V0UHJvdmlkZXIocHJvdmlkZXJJZCk7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcHJvdmlkZXIuZmV0Y2hNb2RlbHMoKTtcblxuICAgICAgICAgICAgICAgIG1vZGVsRHJvcGRvd24uaW5uZXJIVE1MID0gJyc7XG4gICAgICAgICAgICAgICAgcmVzLm1vZGVscy5mb3JFYWNoKChtOiBMTE1Nb2RlbCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBtb2RlbERyb3Bkb3duLmNyZWF0ZUVsKCdvcHRpb24nLCB7IHZhbHVlOiBtLmlkLCB0ZXh0OiBtLm5hbWUgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBzYXZlZE1vZGVsID0gdGhpcy5ibG9ja1NldHRpbmdzLnlhbWxDb25maWcubW9kZWw7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVmYXVsdE1vZGVsID0gcHJvdmlkZXJJZCA9PT0gJ29sbGFtYScgPyB0aGlzLnNlcnZpY2UuZ2V0U2V0dGluZ3MoKS5vbGxhbWEubW9kZWwgOiB0aGlzLnNlcnZpY2UuZ2V0U2V0dGluZ3MoKS5vcGVuYWkubW9kZWw7XG5cbiAgICAgICAgICAgICAgICBtb2RlbERyb3Bkb3duLnZhbHVlID0gc2F2ZWRNb2RlbCB8fCBkZWZhdWx0TW9kZWw7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnRmFpbGVkIHRvIGxvYWQgbW9kZWxzIGZvciBzZWxlY3RlZCBwcm92aWRlcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHBvcHVsYXRlTW9kZWxzKCk7XG5cbiAgICAgICAgcHJvdmlkZXJEcm9wZG93bi5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBwcm92aWRlcklkID0gcHJvdmlkZXJEcm9wZG93bi52YWx1ZSBhcyBQcm92aWRlclR5cGU7XG4gICAgICAgICAgICB0aGlzLmJsb2NrU2V0dGluZ3MueWFtbENvbmZpZy5wcm92aWRlciA9IHByb3ZpZGVySWQ7XG4gICAgICAgICAgICB0aGlzLmJsb2NrU2V0dGluZ3MueWFtbENvbmZpZy5tb2RlbCA9ICcnOyAvLyBSZXNldCBtb2RlbCBvbiBwcm92aWRlciBjaGFuZ2VcblxuICAgICAgICAgICAgY29uc3QgbmV3WWFtbCA9IHRoaXMubWFuYWdlci5nZW5lcmF0ZVlhbWxGcm9tQ29uZmlnKHRoaXMuYmxvY2tTZXR0aW5ncy55YW1sQ29uZmlnKTtcbiAgICAgICAgICAgIHRoaXMubWFuYWdlci51cGRhdGVGaWxlQmxvY2sodGhpcy5lbCwgdGhpcy5jdHgsIHByb21wdElucHV0LmlubmVyVGV4dC50cmltKCksIG5ld1lhbWwpO1xuICAgICAgICAgICAgaWYgKGNvbmZpZ1RleHRhcmVhKSBjb25maWdUZXh0YXJlYS52YWx1ZSA9IG5ld1lhbWw7XG5cbiAgICAgICAgICAgIGF3YWl0IHBvcHVsYXRlTW9kZWxzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIG1vZGVsRHJvcGRvd24uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5ibG9ja1NldHRpbmdzLnlhbWxDb25maWcubW9kZWwgPSBtb2RlbERyb3Bkb3duLnZhbHVlO1xuICAgICAgICAgICAgY29uc3QgbmV3WWFtbCA9IHRoaXMubWFuYWdlci5nZW5lcmF0ZVlhbWxGcm9tQ29uZmlnKHRoaXMuYmxvY2tTZXR0aW5ncy55YW1sQ29uZmlnKTtcbiAgICAgICAgICAgIHRoaXMubWFuYWdlci51cGRhdGVGaWxlQmxvY2sodGhpcy5lbCwgdGhpcy5jdHgsIHByb21wdElucHV0LmlubmVyVGV4dC50cmltKCksIG5ld1lhbWwpO1xuICAgICAgICAgICAgaWYgKGNvbmZpZ1RleHRhcmVhKSBjb25maWdUZXh0YXJlYS52YWx1ZSA9IG5ld1lhbWw7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChjb3B5QnV0dG9uKSB7XG4gICAgICAgICAgICBjb3B5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBwcm9tcHRJbnB1dC5pbm5lclRleHQudHJpbSgpO1xuICAgICAgICAgICAgICAgIGlmICh0ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KHRleHQpO1xuICAgICAgICAgICAgICAgICAgICBuZXcgTm90aWNlKCdQcm9tcHQgY29waWVkIHRvIGNsaXBib2FyZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNsZWFyQnV0dG9uKSB7XG4gICAgICAgICAgICBjbGVhckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICBwcm9tcHRJbnB1dC5pbm5lclRleHQgPSAnJztcbiAgICAgICAgICAgICAgICB1cGRhdGVTdWJtaXRCdXR0b25TdGF0ZSgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHlhbWwgPSB0aGlzLmJsb2NrU2V0dGluZ3MuaGFzWWFtbCA/IGNvbmZpZ1RleHRhcmVhLnZhbHVlIDogJyc7XG4gICAgICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLnVwZGF0ZUZpbGVCbG9jayh0aGlzLmVsLCB0aGlzLmN0eCwgJycsIHlhbWwpO1xuICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoJ1Byb21wdCBjbGVhcmVkJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhZHZhbmNlZEJ1dHRvbikge1xuICAgICAgICAgICAgYWR2YW5jZWRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNIaWRkZW4gPSBjb25maWdEaXNwbGF5LnN0eWxlLmRpc3BsYXkgPT09ICdub25lJztcbiAgICAgICAgICAgICAgICBjb25maWdEaXNwbGF5LnN0eWxlLmRpc3BsYXkgPSBpc0hpZGRlbiA/ICdibG9jaycgOiAnbm9uZSc7XG4gICAgICAgICAgICAgICAgYWR2YW5jZWRCdXR0b24uc3R5bGUuYmFja2dyb3VuZCA9IGlzSGlkZGVuID8gJ3ZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYWN0aXZlLWhvdmVyKScgOiAndHJhbnNwYXJlbnQnO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25maWdUZXh0YXJlYS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHRoaXMuZGVib3VuY2UoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubWFuYWdlci51cGRhdGVGaWxlQmxvY2sodGhpcy5lbCwgdGhpcy5jdHgsIHByb21wdElucHV0LmlubmVyVGV4dC50cmltKCksIGNvbmZpZ1RleHRhcmVhLnZhbHVlLnRyaW0oKSk7XG4gICAgICAgICAgICB9LCAxMDAwKSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB1cGRhdGVSZXNwb25zZUNvdW50ID0gdGhpcy5kZWJvdW5jZSgodmFsOiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgIHRoaXMuYmxvY2tTZXR0aW5ncy55YW1sQ29uZmlnLm51bV9yZXNwb25zZXMgPSB2YWw7XG4gICAgICAgICAgICBjb25zdCBuZXdZYW1sID0gdGhpcy5tYW5hZ2VyLmdlbmVyYXRlWWFtbEZyb21Db25maWcodGhpcy5ibG9ja1NldHRpbmdzLnlhbWxDb25maWcpO1xuICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLnVwZGF0ZUZpbGVCbG9jayh0aGlzLmVsLCB0aGlzLmN0eCwgcHJvbXB0SW5wdXQuaW5uZXJUZXh0LnRyaW0oKSwgbmV3WWFtbCk7XG4gICAgICAgICAgICBpZiAoY29uZmlnVGV4dGFyZWEpIGNvbmZpZ1RleHRhcmVhLnZhbHVlID0gbmV3WWFtbDtcbiAgICAgICAgfSwgMTAwMCk7XG5cbiAgICAgICAgcmVzcG9uc2VzU2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCkgPT4ge1xuICAgICAgICAgICAgcmVzcG9uc2VzSW5wdXQudmFsdWUgPSByZXNwb25zZXNTbGlkZXIudmFsdWU7XG4gICAgICAgICAgICB1cGRhdGVSZXNwb25zZUNvdW50KHBhcnNlSW50KHJlc3BvbnNlc1NsaWRlci52YWx1ZSkpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVzcG9uc2VzSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKSA9PiB7XG4gICAgICAgICAgICByZXNwb25zZXNTbGlkZXIudmFsdWUgPSByZXNwb25zZXNJbnB1dC52YWx1ZTtcbiAgICAgICAgICAgIHVwZGF0ZVJlc3BvbnNlQ291bnQocGFyc2VJbnQocmVzcG9uc2VzSW5wdXQudmFsdWUpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3Qgc3RhcnRHZW5lcmF0aW9uID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGlzR2VuZXJhdGluZykge1xuICAgICAgICAgICAgICAgIGFib3J0Q29udHJvbGxlcj8uYWJvcnQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHByb21wdCA9IHByb21wdElucHV0LmlubmVyVGV4dC50cmltKCk7XG4gICAgICAgICAgICBpZiAoIXByb21wdCkgcmV0dXJuO1xuXG4gICAgICAgICAgICBpc0dlbmVyYXRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgdXBkYXRlU3VibWl0QnV0dG9uU3RhdGUoKTtcblxuICAgICAgICAgICAgY29uc3QgY291bnQgPSBwYXJzZUludChyZXNwb25zZXNJbnB1dC52YWx1ZSkgfHwgMTtcbiAgICAgICAgICAgIHJlc3BvbnNlc1dyYXBwZXIuc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcbiAgICAgICAgICAgIHJlc3BvbnNlc1dyYXBwZXIuaW5uZXJIVE1MID0gJyc7XG5cbiAgICAgICAgICAgIGFib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgICAgICAgICAgIGNvbnN0IHByb3ZpZGVySWQgPSBwcm92aWRlckRyb3Bkb3duLnZhbHVlO1xuICAgICAgICAgICAgY29uc3QgcHJvdmlkZXIgPSB0aGlzLnNlcnZpY2UuZ2V0UHJvdmlkZXIocHJvdmlkZXJJZCk7XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSByZXNwb25zZXNXcmFwcGVyLmNyZWF0ZURpdih7IGNsczogJ29sbGFtYS1yZXNwb25zZS1pdGVtJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5zdHlsZS5jc3NUZXh0ID0gJ2JhY2tncm91bmQ6IHZhcigtLWJhY2tncm91bmQtcHJpbWFyeSk7IGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyKTsgYm9yZGVyLXJhZGl1czogOHB4OyBwYWRkaW5nOiAxMnB4OyBtYXJnaW4tYm90dG9tOiA4cHg7JztcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGl0ZW0uY3JlYXRlRGl2KCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG91dHB1dFByZSA9IGNvbnRlbnQuY3JlYXRlRWwoJ3ByZScsIHsgY2xzOiAnb2xsYW1hLW91dHB1dCcgfSk7XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dFByZS5zdHlsZS5jc3NUZXh0ID0gJ3doaXRlLXNwYWNlOiBwcmUtd3JhcDsgZm9udC1zaXplOiB2YXIoLS1mb250LXNtYWxsZXIpOyBmb250LWZhbWlseTogdmFyKC0tZm9udC1tb25vc3BhY2UpOyc7XG5cbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzdGF0c1Nob3duID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmb290ZXJDb250YWluZXIgPSBpdGVtLmNyZWF0ZURpdih7IGNsczogJ29sbGFtYS1yZXNwb25zZS1mb290ZXInIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9vdGVyQ29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSAnZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBhbGlnbi1pdGVtczogZmxleC1lbmQ7IG1hcmdpbi10b3A6IDhweDsgYm9yZGVyLXRvcDogMXB4IHNvbGlkIHZhcigtLWJhY2tncm91bmQtbW9kaWZpZXItYm9yZGVyKTsgcGFkZGluZy10b3A6IDRweDsgcG9zaXRpb246IHJlbGF0aXZlOyc7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvcHlSZXNwQnV0dG9uID0gZm9vdGVyQ29udGFpbmVyLmNyZWF0ZUVsKCdidXR0b24nLCB7IGNsczogJ29sbGFtYS1yZXNwb25zZS1jb3B5LWJ1dHRvbicgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRJY29uKGNvcHlSZXNwQnV0dG9uLCAnY29weScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29weVJlc3BCdXR0b24uc3R5bGUuY3NzVGV4dCA9ICdwYWRkaW5nOiA0cHg7IGJvcmRlcjogbm9uZTsgYm9yZGVyLXJhZGl1czogNHB4OyBjdXJzb3I6IHBvaW50ZXI7IGJhY2tncm91bmQ6IHRyYW5zcGFyZW50OyBvcGFjaXR5OiAwLjM7IHRyYW5zaXRpb246IG9wYWNpdHkgMC4yczsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7JztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcHlSZXNwQnV0dG9uLnRpdGxlID0gJ0NvcHkgcmVzcG9uc2UnO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29weVJlc3BCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsICgpID0+IGNvcHlSZXNwQnV0dG9uLnN0eWxlLm9wYWNpdHkgPSAnMScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29weVJlc3BCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsICgpID0+IGNvcHlSZXNwQnV0dG9uLnN0eWxlLm9wYWNpdHkgPSAnMC4zJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb3B5UmVzcEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChvdXRwdXRQcmUudGV4dENvbnRlbnQgfHwgJycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoJ1Jlc3BvbnNlIGNvcGllZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRzRGl2ID0gZm9vdGVyQ29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogJ29sbGFtYS1zdGF0cycgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0c0Rpdi5zdHlsZS5jc3NUZXh0ID0gJ2ZvbnQtc2l6ZTogMTBweDsgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOyc7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHByb3ZpZGVyLnN0cmVhbVJlc3BvbnNlKHByb21wdCwgbW9kZWxEcm9wZG93bi52YWx1ZSwgdGhpcy5ibG9ja1NldHRpbmdzLnlhbWxDb25maWcsIGFib3J0Q29udHJvbGxlciwgKGNodW5rKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0UHJlLnRleHRDb250ZW50ICs9IGNodW5rO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgKGZpbmFsKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbmFsLnRvdGFsX2R1cmF0aW9uICYmICFzdGF0c1Nob3duKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzU2hvd24gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvblNlYyA9IChmaW5hbC50b3RhbF9kdXJhdGlvbiAvIDFlOSkudG9GaXhlZCgyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxUb2tlbnMgPSAoZmluYWwucHJvbXB0X2V2YWxfY291bnQgfHwgMCkgKyAoZmluYWwuZXZhbF9jb3VudCB8fCAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHNEaXYudGV4dENvbnRlbnQgPSBgVG9rZW5zOiAke3RvdGFsVG9rZW5zfSB8IFRpbWU6ICR7ZHVyYXRpb25TZWN9c2A7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLm5hbWUgPT09ICdBYm9ydEVycm9yJykgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50LmNyZWF0ZURpdih7IHRleHQ6IGBFcnJvcjogJHtlLm1lc3NhZ2V9YCB9KS5zdHlsZS5jb2xvciA9ICd2YXIoLS10ZXh0LWVycm9yKSc7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICAgICAgaXNHZW5lcmF0aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdXBkYXRlU3VibWl0QnV0dG9uU3RhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBzdWJtaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdGFydEdlbmVyYXRpb24pO1xuXG4gICAgICAgIGNvbnN0IG1hbnVhbFNhdmUgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB5YW1sID0gdGhpcy5ibG9ja1NldHRpbmdzLmhhc1lhbWwgPyBjb25maWdUZXh0YXJlYS52YWx1ZSA6ICcnO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5tYW5hZ2VyLnVwZGF0ZUZpbGVCbG9jayh0aGlzLmVsLCB0aGlzLmN0eCwgcHJvbXB0SW5wdXQuaW5uZXJUZXh0LnRyaW0oKSwgeWFtbCk7XG4gICAgICAgICAgICBuZXcgTm90aWNlKCdTYXZlZCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNhdmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBtYW51YWxTYXZlKTtcblxuICAgICAgICBwcm9tcHRJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHtcbiAgICAgICAgICAgIHVwZGF0ZVN1Ym1pdEJ1dHRvblN0YXRlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHByb21wdElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB5YW1sID0gdGhpcy5ibG9ja1NldHRpbmdzLmhhc1lhbWwgPyBjb25maWdUZXh0YXJlYS52YWx1ZSA6ICcnO1xuICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLnVwZGF0ZUZpbGVCbG9jayh0aGlzLmVsLCB0aGlzLmN0eCwgcHJvbXB0SW5wdXQuaW5uZXJUZXh0LnRyaW0oKSwgeWFtbCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHByb21wdElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZTogS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGUua2V5ID09PSAnRW50ZXInICYmICFlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHN0YXJ0R2VuZXJhdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSAmJiBlLmtleSA9PT0gJ3MnKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIG1hbnVhbFNhdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gVHJhY2sgZm9jdXMvY3Vyc29yIHBvc2l0aW9uXG4gICAgICAgIGNvbnN0IHRyYWNrRm9jdXMgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzZWN0aW9uID0gdGhpcy5jdHguZ2V0U2VjdGlvbkluZm8odGhpcy5lbCk7XG4gICAgICAgICAgICBpZiAoIXNlY3Rpb24pIHJldHVybjtcblxuICAgICAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gd2luZG93LmdldFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgaWYgKCFzZWxlY3Rpb24gfHwgc2VsZWN0aW9uLnJhbmdlQ291bnQgPT09IDApIHJldHVybjtcblxuICAgICAgICAgICAgY29uc3QgcmFuZ2UgPSBzZWxlY3Rpb24uZ2V0UmFuZ2VBdCgwKTtcbiAgICAgICAgICAgIGNvbnN0IHByZVJhbmdlID0gcmFuZ2UuY2xvbmVSYW5nZSgpO1xuICAgICAgICAgICAgcHJlUmFuZ2Uuc2VsZWN0Tm9kZUNvbnRlbnRzKHByb21wdElucHV0KTtcbiAgICAgICAgICAgIHByZVJhbmdlLnNldEVuZChyYW5nZS5zdGFydENvbnRhaW5lciwgcmFuZ2Uuc3RhcnRPZmZzZXQpO1xuICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gcHJlUmFuZ2UudG9TdHJpbmcoKS5sZW5ndGg7XG5cbiAgICAgICAgICAgIHRoaXMubWFuYWdlci5zZXNzaW9uRm9jdXMgPSB7XG4gICAgICAgICAgICAgICAgbGluZVN0YXJ0OiBzZWN0aW9uLmxpbmVTdGFydCxcbiAgICAgICAgICAgICAgICBjaDogb2Zmc2V0LFxuICAgICAgICAgICAgICAgIGZpbGU6IHRoaXMuY3R4LnNvdXJjZVBhdGhcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgcHJvbXB0SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0cmFja0ZvY3VzKTtcbiAgICAgICAgcHJvbXB0SW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRyYWNrRm9jdXMpO1xuICAgICAgICBwcm9tcHRJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIHRyYWNrRm9jdXMpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVzdG9yZUZvY3VzKCkge1xuICAgICAgICBjb25zdCB7IHByb21wdElucHV0IH0gPSB0aGlzLmNvbXBvbmVudHM7XG4gICAgICAgIGNvbnN0IHNlY3Rpb24gPSB0aGlzLmN0eC5nZXRTZWN0aW9uSW5mbyh0aGlzLmVsKTtcbiAgICAgICAgY29uc3QgZm9jdXMgPSB0aGlzLm1hbmFnZXIuc2Vzc2lvbkZvY3VzO1xuXG4gICAgICAgIGlmIChzZWN0aW9uICYmIGZvY3VzLmxpbmVTdGFydCA9PT0gc2VjdGlvbi5saW5lU3RhcnQgJiYgZm9jdXMuZmlsZSA9PT0gdGhpcy5jdHguc291cmNlUGF0aCkge1xuICAgICAgICAgICAgcHJvbXB0SW5wdXQuZm9jdXMoKTtcbiAgICAgICAgICAgIGlmIChmb2N1cy5jaCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICBjb25zdCByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG5cbiAgICAgICAgICAgICAgICBsZXQgY3VycmVudE9mZnNldCA9IDA7XG4gICAgICAgICAgICAgICAgbGV0IHRhcmdldE5vZGU6IE5vZGUgfCBudWxsID0gbnVsbDtcbiAgICAgICAgICAgICAgICBsZXQgdGFyZ2V0T2Zmc2V0ID0gMDtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGZpbmROb2RlID0gKG5vZGU6IE5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IE5vZGUuVEVYVF9OT0RFKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsZW4gPSAobm9kZSBhcyBUZXh0KS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudE9mZnNldCArIGxlbiA+PSAoZm9jdXMuY2ggYXMgbnVtYmVyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldE5vZGUgPSBub2RlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldE9mZnNldCA9IChmb2N1cy5jaCBhcyBudW1iZXIpIC0gY3VycmVudE9mZnNldDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRPZmZzZXQgKz0gbGVuO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2RlLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmluZE5vZGUobm9kZS5jaGlsZE5vZGVzW2ldKSkgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBmaW5kTm9kZShwcm9tcHRJbnB1dCk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0Tm9kZSkge1xuICAgICAgICAgICAgICAgICAgICByYW5nZS5zZXRTdGFydCh0YXJnZXROb2RlLCB0YXJnZXRPZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICByYW5nZS5jb2xsYXBzZSh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uPy5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uPy5hZGRSYW5nZShyYW5nZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRmFsbGJhY2sgdG8gZW5kXG4gICAgICAgICAgICAgICAgICAgIHJhbmdlLnNlbGVjdE5vZGVDb250ZW50cyhwcm9tcHRJbnB1dCk7XG4gICAgICAgICAgICAgICAgICAgIHJhbmdlLmNvbGxhcHNlKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uPy5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uPy5hZGRSYW5nZShyYW5nZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkZWJvdW5jZShmbjogRnVuY3Rpb24sIHdhaXQ6IG51bWJlcikge1xuICAgICAgICBsZXQgdDogYW55O1xuICAgICAgICByZXR1cm4gKC4uLmFyZ3M6IGFueVtdKSA9PiB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodCk7XG4gICAgICAgICAgICB0ID0gc2V0VGltZW91dCgoKSA9PiBmbi5hcHBseSh0aGlzLCBhcmdzKSwgd2FpdCk7XG4gICAgICAgIH07XG4gICAgfVxufVxuIl19